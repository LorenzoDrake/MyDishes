<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ü–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ –ø–∏—Ç–∞–Ω–∏—è</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
	<script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore-compat.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
        }

        :root {
            --primary: #FFB6C1; /* –ù–µ–∂–Ω–æ-—Ä–æ–∑–æ–≤—ã–π */
            --primary-dark: #FF91A4; /* –¢–µ–º–Ω–µ–µ —Ä–æ–∑–æ–≤—ã–π */
            --secondary: #FFD1DC; /* –°–≤–µ—Ç–ª–æ-—Ä–æ–∑–æ–≤—ã–π */
            --light: #FFF5F7; /* –û—á–µ–Ω—å —Å–≤–µ—Ç–ª—ã–π —Ä–æ–∑–æ–≤—ã–π */
            --dark: #8A4B53; /* –¢–µ–º–Ω–æ-—Ä–æ–∑–æ–≤—ã–π –¥–ª—è —Ç–µ–∫—Å—Ç–∞ */
            --gray: #C97B84; /* –°–µ—Ä–æ-—Ä–æ–∑–æ–≤—ã–π */
            --danger: #FF6B8B; /* –†–æ–∑–æ–≤–æ-–∫—Ä–∞—Å–Ω—ã–π */
            --safe-area-inset-top: env(safe-area-inset-top);
            --safe-area-inset-bottom: env(safe-area-inset-bottom);
        }

        body {
            background-color: #FFF9FB; /* –°–≤–µ—Ç–ª–æ-—Ä–æ–∑–æ–≤—ã–π —Ñ–æ–Ω */
            color: var(--dark);
            line-height: 1.6;
            padding-top: var(--safe-area-inset-top);
            padding-bottom: var(--safe-area-inset-bottom);
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 15px;
        }

        header {
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: white;
            padding: 0;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            margin-bottom: 5px;
            position: sticky;
            top: 0;
            z-index: 100;
            padding-top: calc(5px + var(--safe-area-inset-top));
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        h1 {
            font-size: 1.5rem;
            font-weight: 700;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .logo i {
            font-size: 1.8rem;
        }

nav {
    display: flex;
    gap: 10px;
    overflow-x: auto;
    padding-bottom: 5px;
    -webkit-overflow-scrolling: touch;
    scrollbar-width: none; /* –î–ª—è Firefox */
    -ms-overflow-style: none; /* –î–ª—è IE –∏ Edge */
}

/* –°–∫—Ä—ã–≤–∞–µ–º —Å–∫—Ä–æ–ª–ª–±–∞—Ä –¥–ª—è WebKit –±—Ä–∞—É–∑–µ—Ä–æ–≤ (Chrome, Safari, –Ω–æ–≤—ã–µ –≤–µ—Ä—Å–∏–∏ Edge) */
nav::-webkit-scrollbar {
    display: none;
    width: 0;
    height: 0;
    background: transparent;
}

.nav-btn {
    background: rgba(255, 255, 255, 0.2);
    color: white;
    border: none;
    padding: 8px 15px;
    border-radius: 10px;
    cursor: pointer;
    font-weight: 600;
    transition: all 0.3s ease;
    white-space: nowrap;
    font-size: 0.85rem;
    flex-shrink: 0;
    -webkit-tap-highlight-color: transparent; /* –£–±–∏—Ä–∞–µ–º –ø–æ–¥—Å–≤–µ—Ç–∫—É –ø—Ä–∏ —Ç–∞–ø–µ –Ω–∞ iOS */
}

        .nav-btn:hover, .nav-btn.active {
            background: white;
            color: var(--primary-dark);
        }

        .section {
            display: none;
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.08);
            margin-bottom: 20px;
            border: 1px solid #FFE4E9; /* –†–æ–∑–æ–≤–∞—è –≥—Ä–∞–Ω–∏—Ü–∞ */
        }

        .section.active {
            display: block;
            animation: fadeIn 0.5s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        h2 {
            color: var(--primary-dark);
            margin-bottom: 15px;
            padding-bottom: 8px;
            border-bottom: 2px solid var(--light);
            font-size: 1.2rem;
        }

        .form-group {
            margin-bottom: 15px;
        }

        label {
            display: block;
            margin-bottom: 6px;
            font-weight: 600;
            color: var(--dark);
            font-size: 0.95rem;
        }

        input, select, textarea {
            width: 100%;
            padding: 14px;
            border: 1px solid #FFD1DC;
            border-radius: 10px;
            font-size: 1rem;
            transition: border 0.3s;
            -webkit-appearance: none;
            appearance: none;
            background-color: #FFF9FB;
        }

        input:focus, select:focus, textarea:focus {
            border-color: var(--primary);
            outline: none;
            box-shadow: 0 0 0 2px rgba(255, 182, 193, 0.2);
        }

        select {
            background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='%238A4B53' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6 9 12 15 18 9'%3e%3c/polyline%3e%3c/svg%3e");
            background-repeat: no-repeat;
            background-position: right 14px center;
            background-size: 16px;
            padding-right: 40px;
        }

        .btn {
            background: var(--primary);
            color: white;
            border: none;
            padding: 14px 20px;
            border-radius: 10px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 600;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            width: 100%;
            margin-top: 10px;
            touch-action: manipulation;
        }

        .btn:hover {
            background: var(--primary-dark);
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }

        .btn-secondary {
            background: var(--secondary);
            color: var(--dark);
        }

        .btn-secondary:hover {
            background: #FFC2D1;
        }

        .btn-danger {
            background: var(--danger);
        }

        .btn-danger:hover {
            background: #FF4D6D;
        }

        .search-container {
            position: relative;
            margin-bottom: 15px;
        }

        .search-results {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: white;
            border: 1px solid #FFD1DC;
            border-radius: 0 0 10px 10px;
            max-height: 200px;
            overflow-y: auto;
            z-index: 10;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            display: none;
        }

        .search-result-item {
            padding: 12px 15px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 10px;
            border-bottom: 1px solid #FFE4E9;
            font-size: 0.95rem;
        }

        .search-result-item:hover {
            background: #FFF5F7;
        }

        .search-result-item:last-child {
            border-bottom: none;
        }

        .ingredient-icon {
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: var(--light);
            border-radius: 50%;
            color: var(--primary);
            flex-shrink: 0;
        }

        .ingredients-list {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin: 12px 0;
        }

        .ingredient-tag {
            background: var(--light);
            padding: 8px 12px;
            border-radius: 16px;
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 0.85rem;
            border: 1px solid #FFD1DC;
        }

        .ingredient-tag .remove {
            cursor: pointer;
            color: var(--danger);
            font-weight: bold;
            font-size: 1.1rem;
            line-height: 1;
        }

        .dishes-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 15px;
            margin-top: 15px;
        }

        .dish-card {
            background: white;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s ease;
            border: 1px solid #FFE4E9;
        }

        .dish-card:hover {
            transform: translateY(-3px);
        }

        .dish-image {
            height: 140px;
            background: linear-gradient(45deg, var(--primary), var(--secondary));
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 2.5rem;
        }

        .dish-content {
            padding: 15px;
        }

        .dish-title {
            font-size: 1.1rem;
            font-weight: 600;
            margin-bottom: 8px;
            color: var(--dark);
        }

        .dish-ingredients {
            color: var(--gray);
            font-size: 0.85rem;
            margin-bottom: 12px;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        .dish-actions {
            display: flex;
            gap: 8px;
        }

        .dish-actions .btn {
            margin-top: 0;
            font-size: 0.85rem;
            padding: 10px 15px;
        }

        .week-plan {
            display: grid;
            grid-template-columns: 1fr;
            gap: 15px;
            margin-top: 15px;
        }

        .day-card {
            background: white;
            border-radius: 12px;
            padding: 15px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            border: 1px solid #FFE4E9;
        }

        .day-title {
            font-weight: 600;
            color: var(--primary-dark);
            text-align: center;
            font-size: 1rem;
        }

        .selected-dish {
            background: var(--light);
            padding: 10px;
            border-radius: 8px;
            margin-top: 10px;
            font-size: 0.85rem;
            border: 1px solid #FFD1DC;
        }

        .shopping-list {
            margin-top: 15px;
        }

        .shopping-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 14px 0;
            border-bottom: 1px solid #FFE4E9;
        }

        .shopping-item:last-child {
            border-bottom: none;
        }

        .item-info {
            display: flex;
            align-items: center;
            gap: 10px;
            flex: 1;
        }

        .item-actions {
            display: flex;
            gap: 8px;
        }

        .checkbox {
            width: 22px;
            height: 22px;
            accent-color: var(--primary);
        }

        .empty-state {
            text-align: center;
            padding: 30px 15px;
            color: var(--gray);
        }

        .empty-state i {
            font-size: 2.5rem;
            margin-bottom: 12px;
            color: #FFD1DC;
        }

        .fridge-section {
            margin-top: 20px;
        }

        .fridge-items {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-top: 12px;
        }

        .fridge-item {
            background: var(--light);
            padding: 8px 12px;
            border-radius: 16px;
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 0.85rem;
            border: 1px solid #FFD1DC;
        }

        .fridge-item .remove {
            cursor: pointer;
            color: var(--danger);
            font-weight: bold;
            font-size: 1.1rem;
            line-height: 1;
        }

        /* –°—Ç–∏–ª–∏ –¥–ª—è –∫–æ–º–ø–∞–∫—Ç–Ω–æ–≥–æ –ø–ª–∞–Ω–∞ –ø–∏—Ç–∞–Ω–∏—è */
        .compact-day-card {
            background: white;
            border-radius: 12px;
            padding: 15px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            margin-bottom: 15px;
            border: 1px solid #FFE4E9;
        }

        .day-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
            padding-bottom: 8px;
            border-bottom: 1px solid #FFE4E9;
        }

        .day-title {
            font-weight: 600;
            color: var(--primary-dark);
            font-size: 1rem;
        }

        .meal-times {
            display: grid;
            grid-template-columns: 1fr;
            gap: 6px;
        }

        .meal-time {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        .meal-label {
            font-size: 0.8rem;
            font-weight: 600;
            color: var(--gray);
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .meal-label i {
            font-size: 0.9rem;
        }

        .meal-select-container {
            display: flex;
            gap: 8px;
            align-items: center;
        }

        .meal-select {
            flex: 1;
            padding: 7px;
            border: 1px solid #FFD1DC;
            border-radius: 8px;
            font-size: 0.85rem;
            background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='%238A4B53' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6 9 12 15 18 9'%3e%3c/polyline%3e%3c/svg%3e");
            background-repeat: no-repeat;
            background-position: right 10px center;
            background-size: 12px;
            padding-right: 30px;
            background-color: #FFF9FB;
        }

        .add-meal-btn {
            background: var(--primary);
            color: white;
            border: none;
            border-radius: 8px;
            width: 34px;
            height: 34px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.9rem;
            flex-shrink: 0;
            transition: all 0.3s ease;
        }

        .add-meal-btn:hover {
            background: var(--primary-dark);
            transform: scale(1.05);
        }

        .selected-meals {
            margin-top: 8px;
        }

        .selected-meal {
            background: var(--light);
            padding: 4px 6px 4px 11px;
            border-radius: 6px;
            font-size: 0.8rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 5px;
            border: 1px solid #FFD1DC;
        }

        .selected-meal:last-child {
            margin-bottom: 0;
        }

        .meal-actions {
            display: flex;
            gap: 5px;
        }

        .remove-meal {
            background: var(--danger);
            color: white;
            border: none;
            border-radius: 4px;
            width: 22px;
            height: 22px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.7rem;
        }

        /* –£–ª—É—á—à–µ–Ω–∏—è –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤ */
        @media (max-width: 768px) {
            .header-content {
                flex-direction: column;
                gap: 12px;
            }
            
            nav {
                width: 100%;
                justify-content: flex-start;
            }
            
            .container {
                padding: 10px;
            }
            
            .section {
                padding: 15px;
            }
            
            h2 {
                font-size: 1rem;
            }
            
            input, select, textarea {
                padding: 12px;
            }
            
            .btn {
                padding: 12px 16px;
            }
        }

        @media (min-width: 480px) and (max-width: 768px) {
            .dishes-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .week-plan {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (min-width: 768px) {
            .week-plan {
                display: grid;
                grid-template-columns: repeat(2, 1fr);
                gap: 15px;
            }
            
            .meal-times {
                grid-template-columns: 1fr;
            }
        }

        @media (min-width: 1024px) {
            .week-plan {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .meal-times {
                grid-template-columns: 1fr;
            }
        }

        /* –°–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è –¥–ª—è iPhone */
        @supports (-webkit-touch-callout: none) {
            input, select, textarea, .btn {
                font-size: 16px; /* –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞ iOS */
            }
            
            .nav-btn, .btn {
                -webkit-tap-highlight-color: rgba(0, 0, 0, 0.1);
            }
        }

        /* –£–ª—É—á—à–µ–Ω–∏–µ —Å–∫—Ä–æ–ª–ª–∞ –Ω–∞ iOS */
        .search-results, .shopping-list {
            -webkit-overflow-scrolling: touch;
        }

        /* –ö–Ω–æ–ø–∫–∞ –æ—á–∏—Å—Ç–∫–∏ –¥–∞–Ω–Ω—ã—Ö */
        #clear-all-data {
            max-width: 300px;
            margin: 0 auto;
        }
    </style>
</head>
<body>
    <header>
        <div class="container">
            <div class="header-content">
                <div class="logo">
                    <i class="fas fa-utensils"></i>
                    <h1>–ü–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ –ø–∏—Ç–∞–Ω–∏—è</h1>
                </div>
                <nav>
                    <button class="nav-btn active" data-target="dishes-section"><i class="fas fa-book"></i> –ë–ª—é–¥–∞</button>
                    <button class="nav-btn" data-target="add-dish-section"><i class="fas fa-plus"></i> –î–æ–±–∞–≤–∏—Ç—å</button>
                    <button class="nav-btn" data-target="week-plan-section"><i class="fas fa-calendar-alt"></i> –ü–ª–∞–Ω</button>
                    <button class="nav-btn" data-target="shopping-list-section"><i class="fas fa-shopping-cart"></i> –ü–æ–∫—É–ø–∫–∏</button>
                </nav>
            </div>
        </div>
    </header>

    <div class="container">
        <!-- –°–µ–∫—Ü–∏—è —Å –±–ª—é–¥–∞–º–∏ -->
        <section id="dishes-section" class="section active">
            <h2>–ú–æ–∏ –±–ª—é–¥–∞</h2>
            <div class="dishes-grid" id="dishes-container">
                <!-- –ë–ª—é–¥–∞ –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª—è—Ç—å—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
            </div>
        </section>

        <!-- –°–µ–∫—Ü–∏—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –±–ª—é–¥–∞ -->
        <section id="add-dish-section" class="section">
            <h2>–î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤–æ–µ –±–ª—é–¥–æ</h2>
            <form id="add-dish-form">
                <div class="form-group">
                    <label for="dish-name">–ù–∞–∑–≤–∞–Ω–∏–µ –±–ª—é–¥–∞</label>
                    <input type="text" id="dish-name" placeholder="–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –±–ª—é–¥–∞" required>
                </div>
                
                <div class="form-group">
                    <label for="dish-description">–û–ø–∏—Å–∞–Ω–∏–µ –±–ª—é–¥–∞</label>
                    <textarea id="dish-description" rows="3" placeholder="–û–ø–∏—Å–∞–Ω–∏–µ –±–ª—é–¥–∞ (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)"></textarea>
                </div>
                
                <div class="form-group">
                    <label>–ò–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç—ã</label>
                    <div class="search-container">
                        <input type="text" id="ingredient-search" placeholder="–ü–æ–∏—Å–∫ –∏–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç–æ–≤...">
                        <div class="search-results" id="search-results"></div>
                    </div>
                    <div class="ingredients-list" id="selected-ingredients">
                        <!-- –í—ã–±—Ä–∞–Ω–Ω—ã–µ –∏–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç—ã –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª—è—Ç—å—Å—è –∑–¥–µ—Å—å -->
                    </div>
                </div>
                
                <button type="submit" class="btn"><i class="fas fa-save"></i> –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –±–ª—é–¥–æ</button>
            </form>
        </section>

        <!-- –°–µ–∫—Ü–∏—è –ø–ª–∞–Ω–∞ –Ω–∞ –Ω–µ–¥–µ–ª—é -->
        <section id="week-plan-section" class="section">
            <h2>–ü–ª–∞–Ω –ø–∏—Ç–∞–Ω–∏—è –Ω–∞ –Ω–µ–¥–µ–ª—é</h2>
            <div class="week-plan" id="week-plan">
                <!-- –î–Ω–∏ –Ω–µ–¥–µ–ª–∏ –±—É–¥—É—Ç –≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
            </div>
            
            <div class="fridge-section">
                <h3>–ü—Ä–æ–¥—É–∫—Ç—ã –≤ —Ö–æ–ª–æ–¥–∏–ª—å–Ω–∏–∫–µ</h3>
                <div class="search-container">
                    <input type="text" id="fridge-search" placeholder="–î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–¥—É–∫—Ç –≤ —Ö–æ–ª–æ–¥–∏–ª—å–Ω–∏–∫...">
                    <div class="search-results" id="fridge-search-results"></div>
                </div>
                <div class="fridge-items" id="fridge-items">
                    <!-- –ü—Ä–æ–¥—É–∫—Ç—ã –≤ —Ö–æ–ª–æ–¥–∏–ª—å–Ω–∏–∫–µ –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª—è—Ç—å—Å—è –∑–¥–µ—Å—å -->
                </div>
            </div>
            
            <button class="btn" id="generate-shopping-list"><i class="fas fa-cart-plus"></i> –°—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞—Ç—å —Å–ø–∏—Å–æ–∫ –ø–æ–∫—É–ø–æ–∫</button>
        </section>

        <!-- –°–µ–∫—Ü–∏—è —Å–ø–∏—Å–∫–∞ –ø–æ–∫—É–ø–æ–∫ -->
        <section id="shopping-list-section" class="section">
            <h2>–ú–æ–π —Å–ø–∏—Å–æ–∫ –ø–æ–∫—É–ø–æ–∫</h2>
            <div class="shopping-list" id="shopping-list">
                <!-- –≠–ª–µ–º–µ–Ω—Ç—ã —Å–ø–∏—Å–∫–∞ –ø–æ–∫—É–ø–æ–∫ –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª—è—Ç—å—Å—è –∑–¥–µ—Å—å -->
            </div>
        </section>
        
        <div class="form-group" style="margin-top: 30px; text-align: center;">
            <button class="btn btn-danger" id="clear-all-data">
                <i class="fas fa-trash-alt"></i> –û—á–∏—Å—Ç–∏—Ç—å –≤—Å–µ –¥–∞–Ω–Ω—ã–µ
            </button>
        </div>
    </div>

<script>
    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Firebase
    const firebaseConfig = {
        apiKey: "AIzaSyDcguAmbPrkfHvPnKiD9TtbKkNaXkSbGzU",
        authDomain: "mydishes-60046.firebaseapp.com",
        projectId: "mydishes-60046",
        storageBucket: "mydishes-60046.firebasestorage.app",
        messagingSenderId: "625904144384",
        appId: "1:625904144384:web:8c98a6ea3e6c3d06c4c8e5",
        measurementId: "G-JSMF6HSHR4"
    };

    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º Firebase
    const app = firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    // ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–¥–ª—è –æ–¥–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è)
    const USER_ID = "single_user";

    // –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –∏–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç–æ–≤ —Å –∏–∫–æ–Ω–∫–∞–º–∏
    const ingredientsDB = [
        { id: 1, name: "–ö–∞—Ä—Ç–æ—Ñ–µ–ª—å", icon: "ü•î" },
        { id: 2, name: "–ú–æ—Ä–∫–æ–≤—å", icon: "ü•ï" },
        { id: 3, name: "–õ—É–∫", icon: "üßÖ" },
        { id: 4, name: "–ß–µ—Å–Ω–æ–∫", icon: "üßÑ" },
        { id: 5, name: "–ü–æ–º–∏–¥–æ—Ä", icon: "üçÖ" },
        { id: 6, name: "–û–≥—É—Ä–µ—Ü", icon: "ü•í" },
        { id: 7, name: "–ü–µ—Ä–µ—Ü", icon: "ü´ë" },
        { id: 8, name: "–ö–∞–ø—É—Å—Ç–∞", icon: "ü•¨" },
        { id: 9, name: "–ë—Ä–æ–∫–∫–æ–ª–∏", icon: "ü•¶" },
        { id: 10, name: "–ö—É—Ä–∏—Ü–∞", icon: "üçó" },
        { id: 11, name: "–ì–æ–≤—è–¥–∏–Ω–∞", icon: "ü•©" },
        { id: 12, name: "–°–≤–∏–Ω–∏–Ω–∞", icon: "üêñ" },
        { id: 13, name: "–†—ã–±–∞", icon: "üêü" },
        { id: 14, name: "–Ø–π—Ü–∞", icon: "ü•ö" },
        { id: 15, name: "–ú–æ–ª–æ–∫–æ", icon: "ü•õ" },
        { id: 16, name: "–°—ã—Ä", icon: "üßÄ" },
        { id: 17, name: "–ú–∞—Å–ª–æ", icon: "üßà" },
        { id: 18, name: "–°–º–µ—Ç–∞–Ω–∞", icon: "ü•£" },
        { id: 19, name: "–†–∏—Å", icon: "üçö" },
        { id: 20, name: "–ú–∞–∫–∞—Ä–æ–Ω—ã", icon: "üçù" },
        { id: 21, name: "–•–ª–µ–±", icon: "üçû" },
        { id: 22, name: "–ú—É–∫–∞", icon: "üåæ" },
        { id: 23, name: "–°–∞—Ö–∞—Ä", icon: "üçö" },
        { id: 24, name: "–°–æ–ª—å", icon: "üßÇ" },
        { id: 25, name: "–ü–µ—Ä–µ—Ü", icon: "üå∂Ô∏è" },
        { id: 26, name: "–ú–∞—Å–ª–æ —Ä–∞—Å—Ç–∏—Ç–µ–ª—å–Ω–æ–µ", icon: "ü´í" },
        { id: 27, name: "–ó–µ–ª–µ–Ω—å", icon: "üåø" },
        { id: 28, name: "–ì—Ä–∏–±—ã", icon: "üçÑ" },
        { id: 29, name: "–§–∞—Å–æ–ª—å", icon: "ü´ò" },
        { id: 30, name: "–ì–æ—Ä–æ—Ö", icon: "ü´õ" }
    ];

    // –õ–æ–∫–∞–ª—å–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ –¥–ª—è –±–ª—é–¥ (–∫–µ—à)
    let dishes = [];
    
    // –õ–æ–∫–∞–ª—å–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ –¥–ª—è –ø–ª–∞–Ω–∞ –Ω–∞ –Ω–µ–¥–µ–ª—é (–∫–µ—à)
    let weekPlan = {
        monday: { breakfast: [], lunch: [], dinner: [] },
        tuesday: { breakfast: [], lunch: [], dinner: [] },
        wednesday: { breakfast: [], lunch: [], dinner: [] },
        thursday: { breakfast: [], lunch: [], dinner: [] },
        friday: { breakfast: [], lunch: [], dinner: [] },
        saturday: { breakfast: [], lunch: [], dinner: [] },
        sunday: { breakfast: [], lunch: [], dinner: [] }
    };
    
    // –õ–æ–∫–∞–ª—å–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ –¥–ª—è —Ö–æ–ª–æ–¥–∏–ª—å–Ω–∏–∫–∞ (–∫–µ—à)
    let fridgeItems = [];
    
    // –õ–æ–∫–∞–ª—å–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ –¥–ª—è —Å–ø–∏—Å–∫–∞ –ø–æ–∫—É–ø–æ–∫ (–∫–µ—à)
    let shoppingList = [];

    // DOM —ç–ª–µ–º–µ–Ω—Ç—ã
    const navButtons = document.querySelectorAll('.nav-btn');
    const sections = document.querySelectorAll('.section');
    const addDishForm = document.getElementById('add-dish-form');
    const ingredientSearch = document.getElementById('ingredient-search');
    const searchResults = document.getElementById('search-results');
    const selectedIngredients = document.getElementById('selected-ingredients');
    const dishesContainer = document.getElementById('dishes-container');
    const daySelects = document.querySelectorAll('.day-select');
    const generateShoppingListBtn = document.getElementById('generate-shopping-list');
    const shoppingListContainer = document.getElementById('shopping-list');
    const fridgeSearch = document.getElementById('fridge-search');
    const fridgeSearchResults = document.getElementById('fridge-search-results');
    const fridgeItemsContainer = document.getElementById('fridge-items');

    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
    document.addEventListener('DOMContentLoaded', function() {
        // –ù–∞–≤–∏–≥–∞—Ü–∏—è –º–µ–∂–¥—É —Å–µ–∫—Ü–∏—è–º–∏
        navButtons.forEach(button => {
            button.addEventListener('click', function() {
                const targetId = this.getAttribute('data-target');
                
                // –û–±–Ω–æ–≤–ª—è–µ–º –∞–∫—Ç–∏–≤–Ω—ã–µ –∫–Ω–æ–ø–∫–∏
                navButtons.forEach(btn => btn.classList.remove('active'));
                this.classList.add('active');
                
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ü–µ–ª–µ–≤—É—é —Å–µ–∫—Ü–∏—é
                sections.forEach(section => section.classList.remove('active'));
                document.getElementById(targetId).classList.add('active');
            });
        });
        
        // –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –∏–∑ Firebase
        loadAllData();
        
        // –ü–æ–∏—Å–∫ –∏–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç–æ–≤ –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ –±–ª—é–¥–∞
        ingredientSearch.addEventListener('input', function() {
            const query = this.value.toLowerCase();
            if (query.length < 2) {
                searchResults.style.display = 'none';
                return;
            }
            
            const filteredIngredients = ingredientsDB.filter(ingredient => 
                ingredient.name.toLowerCase().includes(query)
            );
            
            displaySearchResults(filteredIngredients, searchResults, addIngredient);
        });
        
        // –ü–æ–∏—Å–∫ –∏–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç–æ–≤ –¥–ª—è —Ö–æ–ª–æ–¥–∏–ª—å–Ω–∏–∫–∞
        fridgeSearch.addEventListener('input', function() {
            const query = this.value.toLowerCase();
            if (query.length < 2) {
                fridgeSearchResults.style.display = 'none';
                return;
            }
            
            const filteredIngredients = ingredientsDB.filter(ingredient => 
                ingredient.name.toLowerCase().includes(query)
            );
            
            displaySearchResults(filteredIngredients, fridgeSearchResults, addToFridge);
        });
        
        // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –±–ª—é–¥–∞
        addDishForm.addEventListener('submit', function(e) {
            e.preventDefault();
            
            const dishName = document.getElementById('dish-name').value;
            const dishDescription = document.getElementById('dish-description').value;
            
            // –ü–æ–ª—É—á–∞–µ–º –≤—ã–±—Ä–∞–Ω–Ω—ã–µ –∏–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç—ã
            const ingredients = [];
            selectedIngredients.querySelectorAll('.ingredient-tag').forEach(tag => {
                const id = parseInt(tag.getAttribute('data-id'));
                const name = tag.getAttribute('data-name');
                const icon = tag.getAttribute('data-icon');
                ingredients.push({ id, name, icon });
            });
            
            if (ingredients.length === 0) {
                alert('–î–æ–±–∞–≤—å—Ç–µ —Ö–æ—Ç—è –±—ã –æ–¥–∏–Ω –∏–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç');
                return;
            }
            
            // –°–æ–∑–¥–∞–µ–º –Ω–æ–≤–æ–µ –±–ª—é–¥–æ
            const newDish = {
                id: Date.now(),
                name: dishName,
                description: dishDescription,
                ingredients: ingredients
            };
            
            // –î–æ–±–∞–≤–ª—è–µ–º –≤ –º–∞—Å—Å–∏–≤ –∏ —Å–æ—Ö—Ä–∞–Ω—è–µ–º –≤ Firebase
            dishes.push(newDish);
            saveDishesToFirebase();
            
            // –û—á–∏—â–∞–µ–º —Ñ–æ—Ä–º—É
            addDishForm.reset();
            selectedIngredients.innerHTML = '';
            
            // –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ–º —Å–ø–∏—Å–æ–∫ –±–ª—é–¥
            loadDishes();
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–µ–∫—Ü–∏—é —Å –±–ª—é–¥–∞–º–∏
            navButtons.forEach(btn => btn.classList.remove('active'));
            document.querySelector('[data-target="dishes-section"]').classList.add('active');
            sections.forEach(section => section.classList.remove('active'));
            document.getElementById('dishes-section').classList.add('active');
            
            alert('–ë–ª—é–¥–æ —É—Å–ø–µ—à–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω–æ!');
        });
        
        // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Å–ø–∏—Å–∫–∞ –ø–æ–∫—É–ø–æ–∫
        generateShoppingListBtn.addEventListener('click', generateShoppingList);
        document.getElementById('clear-all-data').addEventListener('click', clearAllData);
    });

    // –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å Firebase
    async function loadAllData() {
        try {
            await loadDishesFromFirebase();
            await loadWeekPlanFromFirebase();
            await loadFridgeItemsFromFirebase();
            await loadShoppingListFromFirebase();
            
            // –û–±–Ω–æ–≤–ª—è–µ–º UI –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ –≤—Å–µ—Ö –¥–∞–Ω–Ω—ã—Ö
            loadDishes();
            loadWeekPlan();
            loadFridgeItems();
            loadShoppingList();
        } catch (error) {
            console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö:', error);
        }
    }

    async function loadDishesFromFirebase() {
        try {
            const doc = await db.collection('users').doc(USER_ID).get();
            if (doc.exists && doc.data().dishes) {
                dishes = doc.data().dishes;
            } else {
                dishes = [];
            }
        } catch (error) {
            console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –±–ª—é–¥:', error);
            dishes = [];
        }
    }

    async function loadWeekPlanFromFirebase() {
        try {
            const doc = await db.collection('users').doc(USER_ID).get();
            if (doc.exists && doc.data().weekPlan) {
                weekPlan = doc.data().weekPlan;
            } else {
                weekPlan = {
                    monday: { breakfast: [], lunch: [], dinner: [] },
                    tuesday: { breakfast: [], lunch: [], dinner: [] },
                    wednesday: { breakfast: [], lunch: [], dinner: [] },
                    thursday: { breakfast: [], lunch: [], dinner: [] },
                    friday: { breakfast: [], lunch: [], dinner: [] },
                    saturday: { breakfast: [], lunch: [], dinner: [] },
                    sunday: { breakfast: [], lunch: [], dinner: [] }
                };
            }
        } catch (error) {
            console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ø–ª–∞–Ω–∞:', error);
        }
    }

    async function loadFridgeItemsFromFirebase() {
        try {
            const doc = await db.collection('users').doc(USER_ID).get();
            if (doc.exists && doc.data().fridgeItems) {
                fridgeItems = doc.data().fridgeItems;
            } else {
                fridgeItems = [];
            }
        } catch (error) {
            console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ö–æ–ª–æ–¥–∏–ª—å–Ω–∏–∫–∞:', error);
            fridgeItems = [];
        }
    }

    async function loadShoppingListFromFirebase() {
        try {
            const doc = await db.collection('users').doc(USER_ID).get();
            if (doc.exists && doc.data().shoppingList) {
                shoppingList = doc.data().shoppingList;
            } else {
                shoppingList = [];
            }
        } catch (error) {
            console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å–ø–∏—Å–∫–∞ –ø–æ–∫—É–ø–æ–∫:', error);
            shoppingList = [];
        }
    }

    async function saveDishesToFirebase() {
        try {
            await db.collection('users').doc(USER_ID).set({
                dishes: dishes
            }, { merge: true });
        } catch (error) {
            console.error('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –±–ª—é–¥:', error);
        }
    }

    async function saveWeekPlanToFirebase() {
        try {
            await db.collection('users').doc(USER_ID).set({
                weekPlan: weekPlan
            }, { merge: true });
        } catch (error) {
            console.error('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –ø–ª–∞–Ω–∞:', error);
        }
    }

    async function saveFridgeItemsToFirebase() {
        try {
            await db.collection('users').doc(USER_ID).set({
                fridgeItems: fridgeItems
            }, { merge: true });
        } catch (error) {
            console.error('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —Ö–æ–ª–æ–¥–∏–ª—å–Ω–∏–∫–∞:', error);
        }
    }

    async function saveShoppingListToFirebase() {
        try {
            await db.collection('users').doc(USER_ID).set({
                shoppingList: shoppingList
            }, { merge: true });
        } catch (error) {
            console.error('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —Å–ø–∏—Å–∫–∞ –ø–æ–∫—É–ø–æ–∫:', error);
        }
    }

    // –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –¥–∞–Ω–Ω—ã–º–∏ (–æ–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å Firebase)
    function saveDishes() {
        saveDishesToFirebase();
    }
    
    function saveWeekPlan() {
        saveWeekPlanToFirebase();
    }
    
    function saveFridgeItems() {
        saveFridgeItemsToFirebase();
    }
    
    function saveShoppingList() {
        saveShoppingListToFirebase();
    }
    
    function loadDishes() {
        dishesContainer.innerHTML = '';
        
        if (dishes.length === 0) {
            dishesContainer.innerHTML = `
                <div class="empty-state">
                    <i class="fas fa-utensils"></i>
                    <h3>–ü–æ–∫–∞ –Ω–µ—Ç –¥–æ–±–∞–≤–ª–µ–Ω–Ω—ã—Ö –±–ª—é–¥</h3>
                    <p>–î–æ–±–∞–≤—å—Ç–µ —Å–≤–æ–µ –ø–µ—Ä–≤–æ–µ –±–ª—é–¥–æ!</p>
                </div>
            `;
            return;
        }
        
        dishes.forEach(dish => {
            const dishCard = document.createElement('div');
            dishCard.className = 'dish-card';
            
            const ingredientsText = dish.ingredients.map(ing => ing.name).join(', ');
            
            dishCard.innerHTML = `
                <div class="dish-image">
                    <i class="fas fa-utensils"></i>
                </div>
                <div class="dish-content">
                    <div class="dish-title">${dish.name}</div>
                    <div class="dish-ingredients">${ingredientsText}</div>
                    <div class="dish-actions">
                        <button class="btn btn-secondary select-dish" data-id="${dish.id}">
                            <i class="fas fa-calendar-plus"></i> –í—ã–±—Ä–∞—Ç—å
                        </button>
                        <button class="btn btn-danger delete-dish" data-id="${dish.id}">
                            <i class="fas fa-trash"></i> –£–¥–∞–ª–∏—Ç—å
                        </button>
                    </div>
                </div>
            `;
            
            dishesContainer.appendChild(dishCard);
        });
        
        // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –∫–Ω–æ–ø–æ–∫
        document.querySelectorAll('.select-dish').forEach(button => {
            button.addEventListener('click', function() {
                const dishId = parseInt(this.getAttribute('data-id'));
                selectDishForWeek(dishId);
            });
        });
        
        document.querySelectorAll('.delete-dish').forEach(button => {
            button.addEventListener('click', function() {
                const dishId = parseInt(this.getAttribute('data-id'));
                deleteDish(dishId);
            });
        });
        
        // –û–±–Ω–æ–≤–ª—è–µ–º –æ–ø—Ü–∏–∏ –≤ —Å–µ–ª–µ–∫—Ç–∞—Ö –Ω–µ–¥–µ–ª—å–Ω–æ–≥–æ –ø–ª–∞–Ω–∞
        updateWeekPlanSelects();
    }
    
    function loadWeekPlan() {
        const weekPlanContainer = document.getElementById('week-plan');
        weekPlanContainer.innerHTML = '';
        
        const days = [
            { key: 'monday', name: '–ü–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫', icon: 'üìÖ' },
            { key: 'tuesday', name: '–í—Ç–æ—Ä–Ω–∏–∫', icon: 'üìÖ' },
            { key: 'wednesday', name: '–°—Ä–µ–¥–∞', icon: 'üìÖ' },
            { key: 'thursday', name: '–ß–µ—Ç–≤–µ—Ä–≥', icon: 'üìÖ' },
            { key: 'friday', name: '–ü—è—Ç–Ω–∏—Ü–∞', icon: 'üìÖ' },
            { key: 'saturday', name: '–°—É–±–±–æ—Ç–∞', icon: 'üéâ' },
            { key: 'sunday', name: '–í–æ—Å–∫—Ä–µ—Å–µ–Ω—å–µ', icon: 'üåû' }
        ];
        
        days.forEach(day => {
            const dayCard = document.createElement('div');
            dayCard.className = 'compact-day-card';
            
            dayCard.innerHTML = `
                <div class="day-header">
                    <div class="day-title">${day.icon} ${day.name}</div>
                </div>
                <div class="meal-times">
                    <div class="meal-time">
                        <div class="meal-label"><i class="fas fa-sun"></i> –ó–∞–≤—Ç—Ä–∞–∫</div>
                        <div class="meal-select-container">
                            <select class="meal-select" data-day="${day.key}" data-meal="breakfast">
                                <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –±–ª—é–¥–æ</option>
                            </select>
                            <button class="add-meal-btn" data-day="${day.key}" data-meal="breakfast">
                                <i class="fas fa-plus"></i>
                            </button>
                        </div>
                        <div class="selected-meals" id="${day.key}-breakfast">
                            <!-- –í—ã–±—Ä–∞–Ω–Ω—ã–µ –±–ª—é–¥–∞ –±—É–¥—É—Ç –∑–¥–µ—Å—å -->
                        </div>
                    </div>
                    <div class="meal-time">
                        <div class="meal-label"><i class="fas fa-cloud-sun"></i> –û–±–µ–¥</div>
                        <div class="meal-select-container">
                            <select class="meal-select" data-day="${day.key}" data-meal="lunch">
                                <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –±–ª—é–¥–æ</option>
                            </select>
                            <button class="add-meal-btn" data-day="${day.key}" data-meal="lunch">
                                <i class="fas fa-plus"></i>
                            </button>
                        </div>
                        <div class="selected-meals" id="${day.key}-lunch">
                            <!-- –í—ã–±—Ä–∞–Ω–Ω—ã–µ –±–ª—é–¥–∞ –±—É–¥—É—Ç –∑–¥–µ—Å—å -->
                        </div>
                    </div>
                    <div class="meal-time">
                        <div class="meal-label"><i class="fas fa-moon"></i> –£–∂–∏–Ω</div>
                        <div class="meal-select-container">
                            <select class="meal-select" data-day="${day.key}" data-meal="dinner">
                                <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –±–ª—é–¥–æ</option>
                            </select>
                            <button class="add-meal-btn" data-day="${day.key}" data-meal="dinner">
                                <i class="fas fa-plus"></i>
                            </button>
                        </div>
                        <div class="selected-meals" id="${day.key}-dinner">
                            <!-- –í—ã–±—Ä–∞–Ω–Ω—ã–µ –±–ª—é–¥–∞ –±—É–¥—É—Ç –∑–¥–µ—Å—å -->
                        </div>
                    </div>
                </div>
            `;
            
            weekPlanContainer.appendChild(dayCard);
        });
        
        // –û–±–Ω–æ–≤–ª—è–µ–º —Å–µ–ª–µ–∫—Ç—ã –∏ –≤—ã–±—Ä–∞–Ω–Ω—ã–µ –±–ª—é–¥–∞
        updateWeekPlanSelects();
        updateSelectedMeals();
        
        // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –∫–Ω–æ–ø–æ–∫ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –±–ª—é–¥
        document.querySelectorAll('.add-meal-btn').forEach(button => {
            button.addEventListener('click', function() {
                const day = this.getAttribute('data-day');
                const meal = this.getAttribute('data-meal');
                const select = document.querySelector(`.meal-select[data-day="${day}"][data-meal="${meal}"]`);
                const dishId = parseInt(select.value);
                
                if (dishId) {
                    addDishToPlan(day, meal, dishId);
                }
            });
        });
    }
    
    function loadFridgeItems() {
        fridgeItemsContainer.innerHTML = '';
        
        if (fridgeItems.length === 0) {
            fridgeItemsContainer.innerHTML = `
                <div style="width: 100%; text-align: center; color: var(--gray); padding: 10px;">
                    –•–æ–ª–æ–¥–∏–ª—å–Ω–∏–∫ –ø—É—Å—Ç
                </div>
            `;
            return;
        }
        
        fridgeItems.forEach(item => {
            const itemElement = document.createElement('div');
            itemElement.className = 'fridge-item';
            itemElement.innerHTML = `
                <span class="ingredient-icon">${item.icon}</span>
                ${item.name}
                <span class="remove" data-id="${item.id}">&times;</span>
            `;
            
            fridgeItemsContainer.appendChild(itemElement);
        });
        
        // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è
        document.querySelectorAll('.fridge-item .remove').forEach(button => {
            button.addEventListener('click', function() {
                const ingredientId = parseInt(this.getAttribute('data-id'));
                removeFromFridge(ingredientId);
            });
        });
    }
    
    function loadShoppingList() {
        shoppingListContainer.innerHTML = '';
        
        if (shoppingList.length === 0) {
            shoppingListContainer.innerHTML = `
                <div class="empty-state">
                    <i class="fas fa-shopping-cart"></i>
                    <h3>–°–ø–∏—Å–æ–∫ –ø–æ–∫—É–ø–æ–∫ –ø—É—Å—Ç</h3>
                    <p>–°–≥–µ–Ω–µ—Ä–∏—Ä—É–π—Ç–µ —Å–ø–∏—Å–æ–∫ –ø–æ–∫—É–ø–æ–∫ –∏–∑ –ø–ª–∞–Ω–∞ –ø–∏—Ç–∞–Ω–∏—è</p>
                </div>
            `;
            return;
        }
        
        shoppingList.forEach(item => {
            const listItem = document.createElement('div');
            listItem.className = 'shopping-item';
            listItem.innerHTML = `
                <div class="item-info">
                    <input type="checkbox" class="checkbox" ${item.checked ? 'checked' : ''}>
                    <span class="ingredient-icon">${item.icon}</span>
                    <span class="item-name" style="${item.checked ? 'text-decoration: line-through; color: var(--gray);' : ''}">${item.name}</span>
                </div>
                <div class="item-actions">
                    <button class="btn btn-danger remove-item" data-id="${item.id}">
                        <i class="fas fa-trash"></i>
                    </button>
                </div>
            `;
            
            shoppingListContainer.appendChild(listItem);
        });
        
        // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è —á–µ–∫–±–æ–∫—Å–æ–≤ –∏ –∫–Ω–æ–ø–æ–∫ —É–¥–∞–ª–µ–Ω–∏—è
        document.querySelectorAll('.shopping-item .checkbox').forEach(checkbox => {
            checkbox.addEventListener('change', function() {
                const itemName = this.closest('.shopping-item').querySelector('.item-name').textContent;
                toggleShoppingItem(itemName);
            });
        });
        
        document.querySelectorAll('.remove-item').forEach(button => {
            button.addEventListener('click', function() {
                const itemId = parseInt(this.getAttribute('data-id'));
                removeFromShoppingList(itemId);
            });
        });
    }
    
    function displaySearchResults(results, container, clickHandler) {
        container.innerHTML = '';
        
        if (results.length === 0) {
            container.style.display = 'none';
            return;
        }
        
        results.forEach(ingredient => {
            const resultItem = document.createElement('div');
            resultItem.className = 'search-result-item';
            resultItem.innerHTML = `
                <span class="ingredient-icon">${ingredient.icon}</span>
                ${ingredient.name}
            `;
            
            resultItem.addEventListener('click', function() {
                clickHandler(ingredient);
                container.style.display = 'none';
            });
            
            container.appendChild(resultItem);
        });
        
        container.style.display = 'block';
    }
    
    function addIngredient(ingredient) {
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–µ –¥–æ–±–∞–≤–ª–µ–Ω –ª–∏ —É–∂–µ –∏–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç
        const isAlreadyAdded = Array.from(selectedIngredients.querySelectorAll('.ingredient-tag'))
            .some(tag => parseInt(tag.getAttribute('data-id')) === ingredient.id);
        
        if (isAlreadyAdded) {
            return;
        }
        
        const ingredientTag = document.createElement('div');
        ingredientTag.className = 'ingredient-tag';
        ingredientTag.setAttribute('data-id', ingredient.id);
        ingredientTag.setAttribute('data-name', ingredient.name);
        ingredientTag.setAttribute('data-icon', ingredient.icon);
        ingredientTag.innerHTML = `
            <span class="ingredient-icon">${ingredient.icon}</span>
            ${ingredient.name}
            <span class="remove">&times;</span>
        `;
        
        // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è
        ingredientTag.querySelector('.remove').addEventListener('click', function() {
            ingredientTag.remove();
        });
        
        selectedIngredients.appendChild(ingredientTag);
        ingredientSearch.value = '';
        searchResults.style.display = 'none';
    }
    
    function addToFridge(ingredient) {
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–µ –¥–æ–±–∞–≤–ª–µ–Ω –ª–∏ —É–∂–µ –∏–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç
        const isAlreadyAdded = fridgeItems.some(item => item.id === ingredient.id);
        
        if (isAlreadyAdded) {
            return;
        }
        
        fridgeItems.push(ingredient);
        saveFridgeItems();
        loadFridgeItems();
        
        fridgeSearch.value = '';
        fridgeSearchResults.style.display = 'none';
    }
    
    function removeFromFridge(ingredientId) {
        fridgeItems = fridgeItems.filter(item => item.id !== ingredientId);
        saveFridgeItems();
        loadFridgeItems();
    }
    
    function selectDishForWeek(dishId) {
        // –ü–µ—Ä–µ—Ö–æ–¥–∏–º –∫ —Ä–∞–∑–¥–µ–ª—É –ø–ª–∞–Ω–∞ –ø–∏—Ç–∞–Ω–∏—è
        navButtons.forEach(btn => btn.classList.remove('active'));
        document.querySelector('[data-target="week-plan-section"]').classList.add('active');
        sections.forEach(section => section.classList.remove('active'));
        document.getElementById('week-plan-section').classList.add('active');
    }
    
    function deleteDish(dishId) {
        if (confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —ç—Ç–æ –±–ª—é–¥–æ?')) {
            dishes = dishes.filter(dish => dish.id !== dishId);
            saveDishes();
            loadDishes();
        }
    }
    
    function updateWeekPlanSelects() {
        document.querySelectorAll('.meal-select').forEach(select => {
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ç–µ–∫—É—â–µ–µ –∑–Ω–∞—á–µ–Ω–∏–µ
            const currentValue = select.value;
            
            // –û—á–∏—â–∞–µ–º –æ–ø—Ü–∏–∏ (–∫—Ä–æ–º–µ –ø–µ—Ä–≤–æ–π)
            while (select.children.length > 1) {
                select.removeChild(select.lastChild);
            }
            
            // –î–æ–±–∞–≤–ª—è–µ–º –±–ª—é–¥–∞
            dishes.forEach(dish => {
                const option = document.createElement('option');
                option.value = dish.id;
                option.textContent = dish.name;
                select.appendChild(option);
            });
            
            // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∑–Ω–∞—á–µ–Ω–∏–µ, –µ—Å–ª–∏ –æ–Ω–æ –µ—Å—Ç—å
            if (currentValue) {
                select.value = currentValue;
            }
        });
    }
    
    function updateSelectedMeals() {
        Object.keys(weekPlan).forEach(day => {
            ['breakfast', 'lunch', 'dinner'].forEach(meal => {
                const container = document.getElementById(`${day}-${meal}`);
                container.innerHTML = '';
                
                weekPlan[day][meal].forEach(dishId => {
                    const dish = dishes.find(d => d.id === dishId);
                    if (dish) {
                        const mealElement = document.createElement('div');
                        mealElement.className = 'selected-meal';
                        mealElement.innerHTML = `
                            ${dish.name}
                            <div class="meal-actions">
                                <button class="remove-meal" data-day="${day}" data-meal="${meal}" data-dish="${dishId}">
                                    <i class="fas fa-times"></i>
                                </button>
                            </div>
                        `;
                        
                        container.appendChild(mealElement);
                    }
                });
            });
        });
        
        // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è –±–ª—é–¥ –∏–∑ –ø–ª–∞–Ω–∞
        document.querySelectorAll('.remove-meal').forEach(button => {
            button.addEventListener('click', function() {
                const day = this.getAttribute('data-day');
                const meal = this.getAttribute('data-meal');
                const dishId = parseInt(this.getAttribute('data-dish'));
                
                removeDishFromPlan(day, meal, dishId);
            });
        });
    }
    
    function addDishToPlan(day, meal, dishId) {
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–µ –¥–æ–±–∞–≤–ª–µ–Ω–æ –ª–∏ —É–∂–µ —ç—Ç–æ –±–ª—é–¥–æ
        if (!weekPlan[day][meal].includes(dishId)) {
            weekPlan[day][meal].push(dishId);
            saveWeekPlan();
            updateSelectedMeals();
        }
    }
    
    function removeDishFromPlan(day, meal, dishId) {
        weekPlan[day][meal] = weekPlan[day][meal].filter(id => id !== dishId);
        saveWeekPlan();
        updateSelectedMeals();
    }
    
    function generateShoppingList() {
        // –°–æ–±–∏—Ä–∞–µ–º –≤—Å–µ –∏–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç—ã –∏–∑ –ø–ª–∞–Ω–∞ –Ω–∞ –Ω–µ–¥–µ–ª—é
        const allIngredients = [];
        
        Object.keys(weekPlan).forEach(day => {
            ['breakfast', 'lunch', 'dinner'].forEach(meal => {
                weekPlan[day][meal].forEach(dishId => {
                    const dish = dishes.find(d => d.id === dishId);
                    if (dish) {
                        dish.ingredients.forEach(ingredient => {
                            allIngredients.push(ingredient);
                        });
                    }
                });
            });
        });
        
        // –ì—Ä—É–ø–ø–∏—Ä—É–µ–º –∏–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç—ã –ø–æ id –∏ –∏—Å–∫–ª—é—á–∞–µ–º —Ç–µ, —á—Ç–æ –µ—Å—Ç—å –≤ —Ö–æ–ª–æ–¥–∏–ª—å–Ω–∏–∫–µ
        const ingredientCounts = {};
        allIngredients.forEach(ingredient => {
            if (!fridgeItems.some(item => item.id === ingredient.id)) {
                if (!ingredientCounts[ingredient.id]) {
                    ingredientCounts[ingredient.id] = {
                        ...ingredient,
                        count: 1
                    };
                } else {
                    ingredientCounts[ingredient.id].count++;
                }
            }
        });
        
        // –§–æ—Ä–º–∏—Ä—É–µ–º —Å–ø–∏—Å–æ–∫ –ø–æ–∫—É–ø–æ–∫
        shoppingList = Object.values(ingredientCounts).map(item => ({
            id: item.id,
            name: item.count > 1 ? `${item.name} (x${item.count})` : item.name,
            icon: item.icon,
            checked: false
        }));
        
        saveShoppingList();
        loadShoppingList();
        
        // –ü–µ—Ä–µ—Ö–æ–¥–∏–º –∫ —Å–ø–∏—Å–∫—É –ø–æ–∫—É–ø–æ–∫
        navButtons.forEach(btn => btn.classList.remove('active'));
        document.querySelector('[data-target="shopping-list-section"]').classList.add('active');
        sections.forEach(section => section.classList.remove('active'));
        document.getElementById('shopping-list-section').classList.add('active');
        
        alert('–°–ø–∏—Å–æ–∫ –ø–æ–∫—É–ø–æ–∫ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω!');
    }
    
    function toggleShoppingItem(itemName) {
        // –ù–∞—Ö–æ–¥–∏–º —ç–ª–µ–º–µ–Ω—Ç –ø–æ –∏–º–µ–Ω–∏ (–±–µ–∑ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞, –µ—Å–ª–∏ –µ—Å—Ç—å)
        const baseName = itemName.replace(/\s*\(x\d+\)$/, '');
        
        shoppingList.forEach(item => {
            const itemBaseName = item.name.replace(/\s*\(x\d+\)$/, '');
            if (itemBaseName === baseName) {
                item.checked = !item.checked;
            }
        });
        
        saveShoppingList();
        loadShoppingList();
    }
    
    function removeFromShoppingList(itemId) {
        shoppingList = shoppingList.filter(item => item.id !== itemId);
        saveShoppingList();
        loadShoppingList();
    }
    
    async function clearAllData() {
        if (confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å –≤—Å–µ –¥–∞–Ω–Ω—ã–µ? –≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–ª—å–∑—è –æ—Ç–º–µ–Ω–∏—Ç—å.')) {
            try {
                // –û—á–∏—â–∞–µ–º Firebase
                await db.collection('users').doc(USER_ID).delete();
                
                // –û—á–∏—â–∞–µ–º –ª–æ–∫–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
                dishes = [];
                weekPlan = {
                    monday: { breakfast: [], lunch: [], dinner: [] },
                    tuesday: { breakfast: [], lunch: [], dinner: [] },
                    wednesday: { breakfast: [], lunch: [], dinner: [] },
                    thursday: { breakfast: [], lunch: [], dinner: [] },
                    friday: { breakfast: [], lunch: [], dinner: [] },
                    saturday: { breakfast: [], lunch: [], dinner: [] },
                    sunday: { breakfast: [], lunch: [], dinner: [] }
                };
                fridgeItems = [];
                shoppingList = [];
                
                loadDishes();
                loadWeekPlan();
                loadFridgeItems();
                loadShoppingList();
                
                alert('–í—Å–µ –¥–∞–Ω–Ω—ã–µ —É–¥–∞–ª–µ–Ω—ã!');
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö:', error);
                alert('–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ –¥–∞–Ω–Ω—ã—Ö');
            }
        }
    }
</script>
</body>
</html>