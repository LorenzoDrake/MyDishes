<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Планировщик питания</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
	<script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore-compat.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
        }

        :root {
            --primary: #FFB6C1; /* Нежно-розовый */
            --primary-dark: #FF91A4; /* Темнее розовый */
            --secondary: #FFD1DC; /* Светло-розовый */
            --light: #FFF5F7; /* Очень светлый розовый */
            --dark: #8A4B53; /* Темно-розовый для текста */
            --gray: #C97B84; /* Серо-розовый */
            --danger: #FF6B8B; /* Розово-красный */
            --safe-area-inset-top: env(safe-area-inset-top);
            --safe-area-inset-bottom: env(safe-area-inset-bottom);
        }

body {
    background: linear-gradient(135deg, #fff0f5 0%, #ffe4ec 25%, #ffd9e3 50%, #ffceda 75%, #ffc2d1 100%);
    color: var(--dark);
    line-height: 1.6;
    padding-top: var(--safe-area-inset-top);
    padding-bottom: var(--safe-area-inset-bottom);
    min-height: 100vh;
}

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 15px;
        }

        header {
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: white;
            padding: 0;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            margin-bottom: 5px;
            position: sticky;
            top: 0;
            z-index: 100;
            padding-top: calc(5px + var(--safe-area-inset-top));
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        h1 {
            font-size: 1.5rem;
            font-weight: 700;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .logo i {
            font-size: 1.8rem;
        }

nav {
            display: flex;
            gap: 12px;
            overflow-x: auto;
            padding-bottom: 5px;
            -webkit-overflow-scrolling: touch;
            scrollbar-width: none;
            -ms-overflow-style: none;
            width: 100%;
            max-width: 100vw;
            margin: 0 -15px;
            padding-left: 15px;
            padding-right: 15px;
			flex-wrap: wrap;
        }

nav::-webkit-scrollbar {
    display: none;
}

.nav-btn {
    background: rgb(231 135 151);
    color: white;
    border: none;
    padding: 8px 12px; /* Уменьшили padding */
    border-radius: 10px;
    cursor: pointer;
    font-weight: 600;
    transition: all 0.3s ease;
    white-space: nowrap;
    font-size: 0.8rem; /* Уменьшили размер шрифта */
    flex-shrink: 0;
    -webkit-tap-highlight-color: transparent;
}

/* Уменьшаем отступы на мобильных */
@media (max-width: 768px) {
    .header-content {
        flex-direction: column;
        gap: 10px;
        //padding: 0 10px;
    }
    
    nav {
        gap: 4px;
        margin: 0 -10px;
        padding-left: 10px;
        padding-right: 10px;
    }
    
    .nav-btn {
        padding: 7px 10px;
        font-size: 0.82rem;
    }
    
    .nav-btn i {
        font-size: 0.76rem; /* Уменьшаем иконки */
    }
}

/* Для очень маленьких экранов */
@media (max-width: 360px) {
    .nav-btn {
        padding: 6px 8px;
        font-size: 0.76rem;
    }
    
    .nav-btn i {
        margin-right: 2px;
    }
}

        .nav-btn:hover, .nav-btn.active {
            background: white;
            color: var(--primary-dark);
        }

        .section {
            display: none;
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.08);
            margin-bottom: 20px;
            border: 1px solid #FFE4E9; /* Розовая граница */
        }

        .section.active {
            display: block;
            animation: fadeIn 0.5s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        h2 {
            color: var(--primary-dark);
            margin-bottom: 15px;
            padding-bottom: 8px;
            border-bottom: 2px solid var(--light);
            font-size: 1.2rem;
        }

        .form-group {
            margin-bottom: 15px;
        }

        label {
            display: block;
            margin-bottom: 6px;
            font-weight: 600;
            color: var(--dark);
            font-size: 0.95rem;
        }

        input, select, textarea {
            width: 100%;
            padding: 8px;
            border: 1px solid #FFD1DC;
            border-radius: 10px;
            font-size: 0.8rem;
            transition: border 0.3s;
            -webkit-appearance: none;
            appearance: none;
            background-color: #FFF9FB;
        }

        input:focus, select:focus, textarea:focus {
            border-color: var(--primary);
            outline: none;
            box-shadow: 0 0 0 2px rgba(255, 182, 193, 0.2);
        }

        select {
            background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='%238A4B53' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6 9 12 15 18 9'%3e%3c/polyline%3e%3c/svg%3e");
            background-repeat: no-repeat;
            background-position: right 14px center;
            background-size: 16px;
            padding-right: 40px;
        }

        .btn {
            background: var(--primary);
            color: white;
            border: none;
            padding: 14px 20px;
            border-radius: 10px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 600;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            width: 100%;
            touch-action: manipulation;
        }

        .btn:hover {
            background: var(--primary-dark);
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }

        .btn-secondary {
            background: var(--secondary);
            color: var(--dark);
        }

        .btn-secondary:hover {
            background: #FFC2D1;
        }

        .btn-danger {
            background: #c52d2d;
			font-size: 0.75rem;
			width: auto !important;
        }

        .btn-danger:hover {
            background: #FF4D6D;
        }

        .search-container {
            position: relative;
            margin-bottom: 15px;
        }

        .search-results {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: white;
            border: 1px solid #FFD1DC;
            border-radius: 0 0 10px 10px;
            max-height: 200px;
            overflow-y: auto;
            z-index: 10;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            display: none;
        }

        .search-result-item {
            padding: 12px 15px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 10px;
            border-bottom: 1px solid #FFE4E9;
            font-size: 0.95rem;
        }

        .search-result-item:hover {
            background: #FFF5F7;
        }

        .search-result-item:last-child {
            border-bottom: none;
        }

        .ingredient-icon {
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: var(--light);
            border-radius: 50%;
            color: var(--primary);
            flex-shrink: 0;
        }

        .ingredients-list {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin: 12px 0;
        }

        .ingredient-tag {
            background: var(--light);
            padding: 8px 12px;
            border-radius: 16px;
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 0.85rem;
            border: 1px solid #FFD1DC;
        }

        .ingredient-tag .remove {
            cursor: pointer;
            color: var(--danger);
            font-weight: bold;
            font-size: 1.1rem;
            line-height: 1;
        }

        .dishes-grid {
            display: grid;
            grid-template-columns: 1fr;
            //gap: 15px;
            margin-top: 15px;
        }

        .dish-card {
            background: white;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s ease;
            border: 1px solid #FFE4E9;
			margin-bottom: 10px;
        }

        .dish-card:hover {
            transform: translateY(-3px);
        }

        .dish-image {
            height: 140px;
            background: linear-gradient(45deg, var(--primary), var(--secondary));
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 2.5rem;
        }

        .dish-content {
            padding: 15px;
        }

        .dish-title {
            font-size: 1.1rem;
            font-weight: 600;
            margin-bottom: 8px;
            color: var(--dark);
        }

        .dish-ingredients {
            color: var(--gray);
            font-size: 0.85rem;
            margin-bottom: 12px;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        .dish-actions {
            display: flex;
            gap: 8px;
        }

        .dish-actions .btn {
            margin-top: 0;
            font-size: 0.85rem;
            padding: 10px 15px;
        }

        .week-plan {
            display: grid;
            grid-template-columns: 1fr;
            gap: 15px;
            margin-top: 15px;
        }

        .day-card {
            background: white;
            border-radius: 12px;
            padding: 15px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            border: 1px solid #FFE4E9;
        }

        .day-title {
            font-weight: 600;
            color: var(--primary-dark);
            text-align: center;
            font-size: 1rem;
        }

        .selected-dish {
            background: var(--light);
            padding: 10px;
            border-radius: 8px;
            margin-top: 10px;
            font-size: 0.85rem;
            border: 1px solid #FFD1DC;
        }

        .shopping-list {
            margin-top: 15px;
        }

        .shopping-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 4px 0;
            border-bottom: 1px solid #FFE4E9;
        }

        .shopping-item:last-child {
            border-bottom: none;
        }

        .item-info {
            display: flex;
            align-items: center;
            gap: 10px;
            flex: 1;
        }

        .item-actions {
            display: flex;
            gap: 8px;
        }

        .checkbox {
            width: 22px;
            height: 22px;
            accent-color: var(--primary);
        }

        .empty-state {
            text-align: center;
            padding: 30px 15px;
            color: var(--gray);
        }

        .empty-state i {
            font-size: 2.5rem;
            margin-bottom: 12px;
            color: #FFD1DC;
        }

        .fridge-section {
            margin-top: 20px;
        }

        .fridge-items {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-top: 12px;
        }

        .fridge-item {
            background: var(--light);
            padding: 8px 12px;
            border-radius: 16px;
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 0.85rem;
            border: 1px solid #FFD1DC;
        }

        .fridge-item .remove {
            cursor: pointer;
            color: var(--danger);
            font-weight: bold;
            font-size: 1.1rem;
            line-height: 1;
        }

        /* Стили для компактного плана питания */
        .compact-day-card {
            background: white;
            border-radius: 12px;
            padding: 15px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            margin-bottom: 15px;
            border: 1px solid #FFE4E9;
        }

        .day-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
            padding-bottom: 8px;
            border-bottom: 1px solid #FFE4E9;
        }

        .day-title {
            font-weight: 600;
            color: var(--primary-dark);
            font-size: 1rem;
        }

        .meal-times {
            display: grid;
            grid-template-columns: 1fr;
            gap: 6px;
        }

        .meal-time {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        .meal-label {
            font-size: 0.8rem;
            font-weight: 600;
            color: var(--gray);
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .meal-label i {
            font-size: 0.9rem;
        }

        .meal-select-container {
            display: flex;
            gap: 8px;
            align-items: center;
        }

        .meal-select {
            flex: 1;
            padding: 7px;
            border: 1px solid #FFD1DC;
            border-radius: 8px;
            font-size: 0.85rem;
            background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='%238A4B53' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6 9 12 15 18 9'%3e%3c/polyline%3e%3c/svg%3e");
            background-repeat: no-repeat;
            background-position: right 10px center;
            background-size: 12px;
            padding-right: 30px;
            background-color: #FFF9FB;
        }

        .add-meal-btn {
            background: var(--primary);
            color: white;
            border: none;
            border-radius: 8px;
            width: 34px;
            height: 34px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.9rem;
            flex-shrink: 0;
            transition: all 0.3s ease;
        }

        .add-meal-btn:hover {
            background: var(--primary-dark);
            transform: scale(1.05);
        }

        .selected-meals {
            margin-top: 8px;
        }

        .selected-meal {
            background: var(--light);
            padding: 4px 6px 4px 11px;
            border-radius: 6px;
            font-size: 0.8rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 5px;
            border: 1px solid #FFD1DC;
        }

        .selected-meal:last-child {
            margin-bottom: 0;
        }

        .meal-actions {
            display: flex;
            gap: 5px;
        }

        .remove-meal {
            background: var(--danger);
            color: white;
            border: none;
            border-radius: 4px;
            width: 22px;
            height: 22px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.7rem;
        }

        /* Улучшения для мобильных устройств */
        @media (max-width: 768px) {
            .header-content {
                flex-direction: column;
                gap: 12px;
            }
            
            nav {
                width: 115%;
                justify-content: center;
            }
            
            .container {
                padding: 10px;
            }
            
            .section {
                padding: 15px;
            }
            
            h2 {
                font-size: 1rem;
            }
            
            input, select, textarea {
                padding: 6px;
            }
            
            .btn {
                padding: 8px 8px;
            }
        }

        @media (min-width: 480px) and (max-width: 768px) {
            .dishes-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .week-plan {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (min-width: 768px) {
            .week-plan {
                display: grid;
                grid-template-columns: repeat(2, 1fr);
                gap: 15px;
            }
            
            .meal-times {
                grid-template-columns: 1fr;
            }
        }

        @media (min-width: 1024px) {
            .week-plan {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .meal-times {
                grid-template-columns: 1fr;
            }
        }

        /* Специфичные улучшения для iPhone */
        @supports (-webkit-touch-callout: none) {
            input, select, textarea, .btn {
                font-size: 16px; /* Предотвращает масштабирование на iOS */
            }
            
            .nav-btn, .btn {
                -webkit-tap-highlight-color: rgba(0, 0, 0, 0.1);
            }
        }

        /* Улучшение скролла на iOS */
        .search-results, .shopping-list {
            -webkit-overflow-scrolling: touch;
        }

        /* Кнопка очистки данных */
        #clear-all-data {
            max-width: 300px;
            margin: 0 auto;
        }
		
		.checkbox-wrapper {
    position: relative;
    width: 22px;
    height: 22px;
}

.custom-checkbox {
    width: 22px;
    height: 22px;
    border: 2px solid var(--gray);
    border-radius: 50%;
    background: transparent;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.3s ease;
}

.custom-checkbox.checked {
    background: var(--primary);
    border-color: var(--primary);
}

.custom-checkbox i {
    color: white;
    font-size: 12px;
}

.dish-image {
    height: 140px;
    background: linear-gradient(45deg, var(--primary), var(--secondary));
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
    font-size: 2.5rem;
    overflow: hidden;
    position: relative;
}

.dish-image img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    transition: transform 0.3s ease;
}

.dish-image i {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
}

.dish-card:hover .dish-image img {
    transform: scale(1.05);
}

/* Индикатор загрузки */
.dish-image.loading::before {
    content: '';
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    width: 30px;
    height: 30px;
    border: 3px solid transparent;
    border-top: 3px solid white;
    border-radius: 50%;
    animation: spin 1s linear infinite;
    z-index: 2;
}

@keyframes spin {
    0% { transform: translate(-50%, -50%) rotate(0deg); }
    100% { transform: translate(-50%, -50%) rotate(360deg); }
}

.nav-btn[data-target="fridge-section"] i {
    /* Заменить содержимое */
}
    </style>
</head>
<body>
    <header>
        <div class="container">
            <div class="header-content">
                <nav>
                    <button class="nav-btn active" data-target="dishes-section"><i class="fas fa-book"></i> Блюда</button>
                    <button class="nav-btn" data-target="week-plan-section"><i class="fas fa-calendar-alt"></i> План</button>
                    <button class="nav-btn" data-target="fridge-section">
    <i class="fas fa-snowflake"></i> Холодильник
</button>
                    <button class="nav-btn" data-target="shopping-list-section"><i class="fas fa-shopping-cart"></i> Покупки</button>
                </nav>
            </div>
        </div>
    </header>

    <div class="container">
        <!-- Секция с блюдами -->
        <section id="dishes-section" class="section active">
            <h2>Мои блюда</h2>
			<button class="nav-btn" data-target="add-dish-section"><i class="fas fa-plus"></i> Добавить</button>
            <div class="dishes-grid" id="dishes-container">
                <!-- Блюда будут добавляться динамически -->
            </div>
        </section>

        <!-- Секция добавления блюда -->
        <section id="add-dish-section" class="section">
            <h2>Добавить новое блюдо</h2>
            <form id="add-dish-form">
                <div class="form-group">
                    <label for="dish-name">Название блюда</label>
                    <input type="text" id="dish-name" placeholder="Введите название блюда" required>
                </div>
                
                <div class="form-group">
                    <label for="dish-description">Описание блюда</label>
                    <textarea id="dish-description" rows="3" placeholder="Описание блюда (необязательно)"></textarea>
                </div>
                
                <div class="form-group">
                    <label>Ингредиенты</label>
                    <div class="search-container">
                        <input type="text" id="ingredient-search" placeholder="Поиск ингредиентов...">
                        <div class="search-results" id="search-results"></div>
                    </div>
                    <div class="ingredients-list" id="selected-ingredients">
                        <!-- Выбранные ингредиенты будут добавляться здесь -->
                    </div>
                </div>
                <button type="button" class="btn btn-secondary" id="back-to-dishes" style="margin-bottom: 10px;">
    <i class="fas fa-arrow-left"></i> Назад к списку блюд
</button>
                <button type="submit" class="btn"><i class="fas fa-save"></i> Сохранить блюдо</button>
				<button type="button" class="btn btn-secondary" id="cancel-edit" style="display: none; margin-top: 10px;">
					<i class="fas fa-times"></i> Отменить редактирование
				</button>
            </form>
        </section>

        <!-- Секция плана на неделю -->
        <section id="week-plan-section" class="section">
            <h2>План питания на неделю</h2>
            <div class="week-plan" id="week-plan">
                <!-- Дни недели будут генерироваться динамически -->
            </div>
            
            <button class="btn" id="generate-shopping-list"><i class="fas fa-cart-plus"></i> Сформировать список покупок</button>
        </section>

        <!-- Новая секция холодильника -->
        <section id="fridge-section" class="section">
            <h2><i class="fas fa-refrigerator"></i> Мой холодильник</h2>
            
            <!-- Форма для добавления продуктов -->
            <div class="form-group">
                <div class="search-container">
                    <input type="text" id="fridge-search" placeholder="Добавить продукт в холодильник...">
                    <div class="search-results" id="fridge-search-results"></div>
                </div>
            </div>
            
            <div class="fridge-items" id="fridge-items">
                <!-- Продукты в холодильнике будут добавляться здесь -->
            </div>
            
            <!-- Кнопка очистки холодильника -->
            <button class="btn btn-danger" id="clear-fridge" style="margin-top: 15px;">
                <i class="fas fa-trash"></i> Очистить холодильник
            </button>
        </section>

        <!-- Секция списка покупок -->
        <section id="shopping-list-section" class="section">
            <h2>Мой список покупок</h2>
            
            <!-- Форма для добавления продуктов -->
            <div class="form-group">
                <div class="search-container">
                    <input type="text" id="shopping-search" placeholder="Добавить продукт в список покупок...">
                    <div class="search-results" id="shopping-search-results"></div>
                </div>
            </div>
            
            <div class="shopping-list" id="shopping-list">
                <!-- Элементы списка покупок будут добавляться здесь -->
            </div>
            
            <!-- Кнопка очистки списка покупок -->
            <button class="btn btn-danger" id="clear-shopping-list" style="margin-top: 15px;">
                <i class="fas fa-trash"></i> Очистить список покупок
            </button>
        </section>
        
        <div class="form-group" style="margin-top: 20px; text-align: right;">
            <button class="btn btn-danger" id="clear-all-data">
                <i class="fas fa-trash-alt"></i> Очистить все данные
            </button>
        </div>
    </div>

<script>

const GOOGLE_API_KEY = 'AIzaSyCl37ZkbfqSsUMQZTeg_mRjAy7IiWmjTs0';
const GOOGLE_SEARCH_ENGINE_ID = 'c19173fd7668741df';

// Функция для получения изображения через Google Custom Search
async function getDishImageFromGoogle(dishName) {
    if (!GOOGLE_API_KEY || !GOOGLE_SEARCH_ENGINE_ID) {
        console.warn('Google API keys not configured');
        return null;
    }
    
    try {
        const query = `${dishName} food recipe cooking`.substring(0, 100);
        const url = `https://www.googleapis.com/customsearch/v1?q=${encodeURIComponent(query)}&cx=${GOOGLE_SEARCH_ENGINE_ID}&key=${GOOGLE_API_KEY}&searchType=image&imgSize=medium&num=1&safe=active`;
        
        const response = await fetch(url);
        
        if (!response.ok) {
            throw new Error(`HTTP error! status: ${response.status}`);
        }
        
        const data = await response.json();
        
        if (data.items && data.items.length > 0) {
            return data.items[0].link;
        } else {
            console.log('No images found for:', dishName);
            return null;
        }
    } catch (error) {
        console.error('Error fetching image from Google:', error);
        return null;
    }
}

// Кэш для уже найденных изображений (чтобы не делать запросы повторно)
const imageCache = new Map();


    // Инициализация Firebase
    const firebaseConfig = {
        apiKey: "AIzaSyDcguAmbPrkfHvPnKiD9TtbKkNaXkSbGzU",
        authDomain: "mydishes-60046.firebaseapp.com",
        projectId: "mydishes-60046",
        storageBucket: "mydishes-60046.firebasestorage.app",
        messagingSenderId: "625904144384",
        appId: "1:625904144384:web:8c98a6ea3e6c3d06c4c8e5",
        measurementId: "G-JSMF6HSHR4"
    };

    // Инициализируем Firebase
    const app = firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    // ID пользователя (для одного пользователя)
    const USER_ID = "single_user";

    // База данных ингредиентов с иконками
const ingredientsDB = [
    { id: 1, name: "Картофель", icon: "🥔" },
    { id: 2, name: "Морковь", icon: "🥕" },
    { id: 3, name: "Лук", icon: "🧅" },
    { id: 4, name: "Чеснок", icon: "🧄" },
    { id: 5, name: "Помидор", icon: "🍅" },
    { id: 6, name: "Огурец", icon: "🥒" },
    { id: 7, name: "Перец", icon: "🫑" },
    { id: 8, name: "Капуста", icon: "🥬" },
    { id: 9, name: "Брокколи", icon: "🥦" },
    { id: 10, name: "Курица", icon: "🍗" },
    { id: 11, name: "Говядина", icon: "🥩" },
    { id: 12, name: "Свинина", icon: "🐖" },
    { id: 13, name: "Рыба", icon: "🐟" },
    { id: 14, name: "Яйца", icon: "🥚" },
    { id: 15, name: "Молоко", icon: "🥛" },
    { id: 16, name: "Сыр", icon: "🧀" },
    { id: 17, name: "Масло", icon: "🧈" },
    { id: 18, name: "Сметана", icon: "🥣" },
    { id: 19, name: "Рис", icon: "🍚" },
    { id: 20, name: "Макароны", icon: "🍝" },
    { id: 21, name: "Хлеб", icon: "🍞" },
    { id: 22, name: "Мука", icon: "🌾" },
    { id: 23, name: "Сахар", icon: "🍚" },
    { id: 24, name: "Соль", icon: "🧂" },
    { id: 25, name: "Перец", icon: "🌶️" },
    { id: 26, name: "Масло растительное", icon: "🫒" },
    { id: 27, name: "Зелень", icon: "🌿" },
    { id: 28, name: "Грибы", icon: "🍄" },
    { id: 29, name: "Фасоль", icon: "🫘" },
    { id: 30, name: "Горох", icon: "🫛" },
    
    // Добавленные по запросу
    { id: 31, name: "Кофе", icon: "☕" },
    { id: 32, name: "Плавленый сыр", icon: "🧀" },
    { id: 33, name: "Кабачок", icon: "🥒" },
    { id: 34, name: "Сгущенка", icon: "🥫" },
    { id: 35, name: "Бумага для жарки", icon: "📜" },
    { id: 36, name: "Пакеты для запекания", icon: "🛍️" },
    { id: 37, name: "Бананы", icon: "🍌" },
    { id: 38, name: "Киви", icon: "🥝" },
    { id: 39, name: "Яблоко", icon: "🍎" },
    { id: 40, name: "Груша", icon: "🍐" },
    
    // Дополнительные овощи
    { id: 41, name: "Баклажан", icon: "🍆" },
    { id: 42, name: "Тыква", icon: "🎃" },
    { id: 43, name: "Свекла", icon: "🍠" },
    { id: 44, name: "Репа", icon: "🥬" },
    { id: 45, name: "Редис", icon: "🌶️" },
    { id: 46, name: "Шпинат", icon: "🍃" },
    { id: 47, name: "Сельдерей", icon: "🥬" },
    { id: 48, name: "Спаржа", icon: "🎍" },
    { id: 49, name: "Кукуруза", icon: "🌽" },
    { id: 50, name: "Авокадо", icon: "🥑" },
    
    // Дополнительные фрукты и ягоды
    { id: 51, name: "Апельсин", icon: "🍊" },
    { id: 52, name: "Лимон", icon: "🍋" },
    { id: 53, name: "Виноград", icon: "🍇" },
    { id: 54, name: "Клубника", icon: "🍓" },
    { id: 55, name: "Малина", icon: "🫐" },
    { id: 56, name: "Черника", icon: "🫐" },
    { id: 57, name: "Ананас", icon: "🍍" },
    { id: 58, name: "Арбуз", icon: "🍉" },
    { id: 59, name: "Дыня", icon: "🍈" },
    { id: 60, name: "Персик", icon: "🍑" },
    { id: 61, name: "Слива", icon: "🍑" },
    { id: 62, name: "Вишня", icon: "🍒" },
    { id: 63, name: "Черешня", icon: "🍒" },
    { id: 64, name: "Гранат", icon: "🍎" },
    { id: 65, name: "Манго", icon: "🥭" },
    
    // Дополнительные продукты
    { id: 66, name: "Йогурт", icon: "🥛" },
    { id: 67, name: "Кефир", icon: "🥛" },
    { id: 68, name: "Творог", icon: "🧀" },
    { id: 69, name: "Сливки", icon: "🥛" },
    { id: 70, name: "Майонез", icon: "🥣" },
    { id: 71, name: "Кетчуп", icon: "🍅" },
    { id: 72, name: "Горчица", icon: "🟡" },
    { id: 73, name: "Мед", icon: "🍯" },
    { id: 74, name: "Орехи", icon: "🥜" },
    { id: 75, name: "Изюм", icon: "🍇" },
    { id: 76, name: "Чай", icon: "🍵" },
    { id: 77, name: "Какао", icon: "🟫" },
    { id: 78, name: "Шоколад", icon: "🍫" },
    { id: 79, name: "Печенье", icon: "🍪" },
    { id: 80, name: "Мороженое", icon: "🍦" },
	{ id: 81, name: "Имбирь", icon: "🫚" },
{ id: 82, name: "Куркума", icon: "🟡" },
{ id: 83, name: "Корица", icon: "🟤" },
{ id: 84, name: "Ваниль", icon: "🌱" },
{ id: 85, name: "Мята", icon: "🌿" },
{ id: 86, name: "Базилик", icon: "🌿" },
{ id: 87, name: "Петрушка", icon: "🌿" },
{ id: 88, name: "Укроп", icon: "🌿" },
{ id: 89, name: "Кинза", icon: "🌿" },
{ id: 90, name: "Розмарин", icon: "🌿" },
{ id: 91, name: "Орегано", icon: "🌿" },
{ id: 92, name: "Тимьян", icon: "🌿" },
{ id: 93, name: "Лавровый лист", icon: "🍃" },
{ id: 94, name: "Перец чили", icon: "🌶️" },
{ id: 95, name: "Халапеньо", icon: "🌶️" },
{ id: 96, name: "Каперсы", icon: "🌿" },
{ id: 97, name: "Оливки", icon: "🫒" },
{ id: 98, name: "Маслины", icon: "🫒" },
{ id: 99, name: "Артишок", icon: "🌱" },
{ id: 100, name: "Спаржа", icon: "🎍" },

// Мясные продукты и птица
{ id: 101, name: "Бекон", icon: "🥓" },
{ id: 102, name: "Ветчина", icon: "🍖" },
{ id: 103, name: "Колбаса", icon: "🌭" },
{ id: 104, name: "Сардельки", icon: "🌭" },
{ id: 105, name: "Сосиски", icon: "🌭" },
{ id: 106, name: "Салями", icon: "🍖" },
{ id: 107, name: "Пепперони", icon: "🍖" },
{ id: 108, name: "Индейка", icon: "🦃" },
{ id: 109, name: "Утка", icon: "🦆" },
{ id: 110, name: "Гусь", icon: "🦆" },

// Морепродукты
{ id: 111, name: "Креветки", icon: "🦐" },
{ id: 112, name: "Кальмары", icon: "🦑" },
{ id: 113, name: "Мидии", icon: "🐚" },
{ id: 114, name: "Устрицы", icon: "🦪" },
{ id: 115, name: "Гребешки", icon: "🐚" },
{ id: 116, name: "Осьминог", icon: "🐙" },
{ id: 117, name: "Икра", icon: "🐟" },
{ id: 118, name: "Лосось", icon: "🐟" },
{ id: 119, name: "Тунец", icon: "🐟" },
{ id: 120, name: "Треска", icon: "🐟" },

// Молочные продукты и альтернативы
{ id: 121, name: "Соевое молоко", icon: "🥛" },
{ id: 122, name: "Миндальное молоко", icon: "🥛" },
{ id: 123, name: "Овсяное молоко", icon: "🥛" },
{ id: 124, name: "Кокосовое молоко", icon: "🥥" },
{ id: 125, name: "Тофу", icon: "🫓" },
{ id: 126, name: "Сейтан", icon: "🌾" },
{ id: 127, name: "Темпе", icon: "🫘" },
{ id: 128, name: "Веганский сыр", icon: "🧀" },
{ id: 129, name: "Пармезан", icon: "🧀" },
{ id: 130, name: "Моцарелла", icon: "🧀" },

// Крупы и злаки
{ id: 131, name: "Гречка", icon: "🍚" },
{ id: 132, name: "Овсянка", icon: "🥣" },
{ id: 133, name: "Киноа", icon: "🌾" },
{ id: 134, name: "Булгур", icon: "🌾" },
{ id: 135, name: "Пшено", icon: "🌾" },
{ id: 136, name: "Перловка", icon: "🍚" },
{ id: 137, name: "Кукурузная крупа", icon: "🌽" },
{ id: 138, name: "Манка", icon: "🌾" },
{ id: 139, name: "Отруби", icon: "🌾" },
{ id: 140, name: "Семена чиа", icon: "🌱" },

// Орехи и семечки
{ id: 141, name: "Миндаль", icon: "🌰" },
{ id: 142, name: "Грецкие орехи", icon: "🌰" },
{ id: 143, name: "Фундук", icon: "🌰" },
{ id: 144, name: "Кешью", icon: "🌰" },
{ id: 145, name: "Фисташки", icon: "🌰" },
{ id: 146, name: "Кедровые орехи", icon: "🌰" },
{ id: 147, name: "Семена подсолнечника", icon: "🌻" },
{ id: 148, name: "Тыквенные семечки", icon: "🎃" },
{ id: 149, name: "Кунжут", icon: "⚫" },
{ id: 150, name: "Льняное семя", icon: "🌱" },

// Соусы и заправки
{ id: 151, name: "Соевый соус", icon: "🫙" },
{ id: 152, name: "Устричный соус", icon: "🫙" },
{ id: 153, name: "Рыбный соус", icon: "🐟" },
{ id: 154, name: "Вустерширский соус", icon: "🫙" },
{ id: 155, name: "Табаско", icon: "🌶️" },
{ id: 156, name: "Сырный соус", icon: "🧀" },
{ id: 157, name: "Бальзамический уксус", icon: "🫙" },
{ id: 158, name: "Яблочный уксус", icon: "🍎" },
{ id: 159, name: "Винный уксус", icon: "🍷" },
{ id: 160, name: "Рисовый уксус", icon: "🍚" },

// Выпечка и сладости
{ id: 161, name: "Дрожжи", icon: "🍞" },
{ id: 162, name: "Разрыхлитель", icon: "🥧" },
{ id: 163, name: "Сода", icon: "⚗️" },
{ id: 164, name: "Желатин", icon: "🍮" },
{ id: 165, name: "Агар-агар", icon: "🌿" },
{ id: 166, name: "Пудра сахарная", icon: "🍚" },
{ id: 167, name: "Карамель", icon: "🍯" },
{ id: 168, name: "Сироп кленовый", icon: "🍁" },
{ id: 169, name: "Сироп топпинг", icon: "🫙" },
{ id: 170, name: "Маршмеллоу", icon: "🍡" },

// Напитки и алкоголь
{ id: 171, name: "Вино красное", icon: "🍷" },
{ id: 172, name: "Вино белое", icon: "🍸" },
{ id: 173, name: "Пиво", icon: "🍺" },
{ id: 174, name: "Водка", icon: "🥃" },
{ id: 175, name: "Виски", icon: "🥃" },
{ id: 176, name: "Ром", icon: "🍹" },
{ id: 177, name: "Текила", icon: "🍸" },
{ id: 178, name: "Ликер", icon: "🥂" },
{ id: 179, name: "Вермут", icon: "🍸" },
{ id: 180, name: "Сок апельсиновый", icon: "🧃" },
{ id: 181, name: "Сок яблочный", icon: "🧃" },
{ id: 182, name: "Сок томатный", icon: "🍅" },
{ id: 183, name: "Сок мультифрукт", icon: "🧃" },
{ id: 184, name: "Лимонад", icon: "🥤" },
{ id: 185, name: "Кола", icon: "🥤" },
{ id: 186, name: "Газировка", icon: "🫧" },
{ id: 187, name: "Минеральная вода", icon: "💧" },
{ id: 188, name: "Энергетик", icon: "⚡" },
{ id: 189, name: "Смузи", icon: "🥤" },
{ id: 190, name: "Квас", icon: "🫖" },

// Консервы и пресервы
{ id: 191, name: "Тунец консервированный", icon: "🐟" },
{ id: 192, name: "Шпроты", icon: "🐟" },
{ id: 193, name: "Сардины", icon: "🐟" },
{ id: 194, name: "Кукуруза консервированная", icon: "🌽" },
{ id: 195, name: "Горошек консервированный", icon: "🫛" },
{ id: 196, name: "Фасоль консервированная", icon: "🫘" },
{ id: 197, name: "Ананасы консервированные", icon: "🍍" },
{ id: 198, name: "Персики консервированные", icon: "🍑" },
{ id: 199, name: "Оливки консервированные", icon: "🫒" },
{ id: 200, name: "Маринованные огурцы", icon: "🥒" },

// Полуфабрикаты
{ id: 201, name: "Пельмени", icon: "🥟" },
{ id: 202, name: "Вареники", icon: "🥟" },
{ id: 203, name: "Хинкали", icon: "🥟" },
{ id: 204, name: "Манты", icon: "🥟" },
{ id: 205, name: "Котлеты замороженные", icon: "🍔" },
{ id: 206, name: "Блины замороженные", icon: "🥞" },
{ id: 207, name: "Пицца замороженная", icon: "🍕" },
{ id: 208, name: "Наггетсы куриные", icon: "🍗" },
{ id: 209, name: "Фрикадельки", icon: "🍡" },
{ id: 210, name: "Лазанья замороженная", icon: "🍝" },

// Хлебобулочные изделия
{ id: 211, name: "Багет", icon: "🥖" },
{ id: 212, name: "Лаваш", icon: "🫓" },
{ id: 213, name: "Пита", icon: "🫓" },
{ id: 214, name: "Тортилья", icon: "🫓" },
{ id: 215, name: "Круассан", icon: "🥐" },
{ id: 216, name: "Булочка сдобная", icon: "🍞" },
{ id: 217, name: "Пончики", icon: "🍩" },
{ id: 218, name: "Пирожки", icon: "🥮" },
{ id: 219, name: "Слойка", icon: "🥐" },
{ id: 220, name: "Сухари", icon: "🍞" },

// Сладости и десерты
{ id: 221, name: "Торт", icon: "🎂" },
{ id: 222, name: "Пирожное", icon: "🍰" },
{ id: 223, name: "Эклер", icon: "🍩" },
{ id: 224, name: "Наполеон", icon: "🍰" },
{ id: 225, name: "Медовик", icon: "🍯" },
{ id: 226, name: "Чизкейк", icon: "🍰" },
{ id: 227, name: "Тирамису", icon: "🍫" },
{ id: 228, name: "Панна котта", icon: "🍮" },
{ id: 229, name: "Мусс", icon: "🍦" },
{ id: 230, name: "Суфле", icon: "🍮" },

// Шоколад и конфеты
{ id: 231, name: "Шоколад молочный", icon: "🍫" },
{ id: 232, name: "Шоколад горький", icon: "🍫" },
{ id: 233, name: "Шоколад белый", icon: "🍫" },
{ id: 234, name: "Пралине", icon: "🍬" },
{ id: 235, name: "Трюфели", icon: "🍫" },
{ id: 236, name: "Карамель", icon: "🍬" },
{ id: 237, name: "Ирис", icon: "🍬" },
{ id: 238, name: "Мармелад", icon: "🍬" },
{ id: 239, name: "Зефир", icon: "🍡" },
{ id: 240, name: "Пастила", icon: "🍬" },

// Мороженое
{ id: 241, name: "Пломбир", icon: "🍦" },
{ id: 242, name: "Щербет", icon: "🍧" },
{ id: 243, name: "Сорбет", icon: "🍧" },
{ id: 244, name: "Эскимо", icon: "🍦" },
{ id: 245, name: "Стаканчик", icon: "🍦" },
{ id: 246, name: "Рожок", icon: "🍦" },
{ id: 247, name: "Мороженое фруктовое", icon: "🍧" },
{ id: 248, name: "Мороженое шоколадное", icon: "🍫" },
{ id: 249, name: "Мороженое ванильное", icon: "🍦" },
{ id: 250, name: "Мороженое крем-брюле", icon: "🍮" },

// Снеки
{ id: 251, name: "Чипсы", icon: "🥔" },
{ id: 252, name: "Сухарики", icon: "🍞" },
{ id: 253, name: "Попкорн", icon: "🍿" },
{ id: 254, name: "Орешки соленые", icon: "🥜" },
{ id: 255, name: "Крекеры", icon: "🍘" },
{ id: 256, name: "Гренки", icon: "🍞" },
{ id: 257, name: "Снеки кукурузные", icon: "🌽" },
{ id: 258, name: "Рыбные палочки", icon: "🐟" },
{ id: 259, name: "Кукурузные палочки", icon: "🌽" },
{ id: 260, name: "Соломка", icon: "🍪" },

// Соусы и пасты
{ id: 261, name: "Паста томатная", icon: "🍅" },
{ id: 262, name: "Паста ореховая", icon: "🥜" },
{ id: 263, name: "Паста кунжутная", icon: "⚫" },
{ id: 264, name: "Соус терияки", icon: "🫙" },
{ id: 265, name: "Соус сацебели", icon: "🫙" },
{ id: 266, name: "Соус тартар", icon: "🫙" },
{ id: 267, name: "Соус цезарь", icon: "🫙" },
{ id: 268, name: "Соус барбекю", icon: "🍖" },
{ id: 269, name: "Соус чили", icon: "🌶️" },
{ id: 270, name: "Соус сладкий чили", icon: "🌶️" },

// Масла и жиры
{ id: 271, name: "Масло оливковое", icon: "🫒" },
{ id: 272, name: "Масло кокосовое", icon: "🥥" },
{ id: 273, name: "Масло подсолнечное", icon: "🌻" },
{ id: 274, name: "Масло кукурузное", icon: "🌽" },
{ id: 275, name: "Масло льняное", icon: "🌱" },
{ id: 276, name: "Масло кунжутное", icon: "⚫" },
{ id: 277, name: "Масло авокадо", icon: "🥑" },
{ id: 278, name: "Масло грецкого ореха", icon: "🌰" },
{ id: 279, name: "Масло виноградной косточки", icon: "🍇" },
{ id: 280, name: "Смалец", icon: "🐖" },

// Специи и приправы
{ id: 281, name: "Карри", icon: "🟡" },
{ id: 282, name: "Паприка", icon: "🔴" },
{ id: 283, name: "Кумин", icon: "🟤" },
{ id: 284, name: "Кориандр", icon: "🌿" },
{ id: 285, name: "Гвоздика", icon: "🌼" },
{ id: 286, name: "Мускатный орех", icon: "🌰" },
{ id: 287, name: "Кардамон", icon: "🟢" },
{ id: 288, name: "Бадьян", icon: "⭐" },
{ id: 289, name: "Шафран", icon: "🟡" },
{ id: 290, name: "Хмели-сунели", icon: "🌿" },

// Овощи и зелень
{ id: 291, name: "Руккола", icon: "🌿" },
{ id: 292, name: "Кресс-салат", icon: "🌿" },
{ id: 293, name: "Лук-порей", icon: "🧅" },
{ id: 294, name: "Лук-шалот", icon: "🧅" },
{ id: 295, name: "Черемша", icon: "🌱" },
{ id: 296, name: "Щавель", icon: "🍃" },
{ id: 297, name: "Ревень", icon: "🍃" },
{ id: 298, name: "Топинамбур", icon: "🍠" },
{ id: 299, name: "Батат", icon: "🍠" },
{ id: 300, name: "Арракача", icon: "🥕" },

// Фрукты и ягоды
{ id: 301, name: "Нектарин", icon: "🍑" },
{ id: 302, name: "Абрикос", icon: "🍑" },
{ id: 303, name: "Инжир", icon: "🍈" },
{ id: 304, name: "Хурма", icon: "🍊" },
{ id: 305, name: "Фейхоа", icon: "🟢" },
{ id: 306, name: "Карамбола", icon: "⭐" },
{ id: 307, name: "Питайя", icon: "🐉" },
{ id: 308, name: "Маракуйя", icon: "🟣" },
{ id: 309, name: "Личи", icon: "🔴" },
{ id: 310, name: "Рамбутан", icon: "🎾" },

// Грибы
{ id: 311, name: "Шампиньоны", icon: "🍄" },
{ id: 312, name: "Вешенки", icon: "🍄" },
{ id: 313, name: "Лисички", icon: "🍄" },
{ id: 314, name: "Белые грибы", icon: "🍄" },
{ id: 315, name: "Подберезовики", icon: "🍄" },
{ id: 316, name: "Подосиновики", icon: "🍄" },
{ id: 317, name: "Маслята", icon: "🍄" },
{ id: 318, name: "Опята", icon: "🍄" },
{ id: 319, name: "Грузди", icon: "🍄" },
{ id: 320, name: "Рыжики", icon: "🍄" },

// Бобовые
{ id: 321, name: "Нут", icon: "🫘" },
{ id: 322, name: "Чечевица", icon: "🫘" },
{ id: 323, name: "Маш", icon: "🫘" },
{ id: 324, name: "Соя", icon: "🫘" },
{ id: 325, name: "Лобио", icon: "🫘" },
{ id: 326, name: "Бобы", icon: "🫘" },
{ id: 327, name: "Арахис", icon: "🥜" },
{ id: 328, name: "Фисташки", icon: "🌰" },
{ id: 329, name: "Кешью", icon: "🌰" },
{ id: 330, name: "Миндаль", icon: "🌰" },

// Молочные продукты
{ id: 331, name: "Ряженка", icon: "🥛" },
{ id: 332, name: "Простокваша", icon: "🥛" },
{ id: 333, name: "Айран", icon: "🥛" },
{ id: 334, name: "Тан", icon: "🥛" },
{ id: 335, name: "Катык", icon: "🥛" },
{ id: 336, name: "Сгущенное молоко", icon: "🥫" },
{ id: 337, name: "Сухое молоко", icon: "🥛" },
{ id: 338, name: "Сливки взбитые", icon: "🍦" },
{ id: 339, name: "Сметана густая", icon: "🥣" },
{ id: 340, name: "Йогурт греческий", icon: "🥛" },

// Сыры
{ id: 341, name: "Брынза", icon: "🧀" },
{ id: 342, name: "Фета", icon: "🧀" },
{ id: 343, name: "Сулугуни", icon: "🧀" },
{ id: 344, name: "Чеддер", icon: "🧀" },
{ id: 345, name: "Гауда", icon: "🧀" },
{ id: 346, name: "Эдам", icon: "🧀" },
{ id: 347, name: "Камамбер", icon: "🧀" },
{ id: 348, name: "Бри", icon: "🧀" },
{ id: 349, name: "Рокфор", icon: "🧀" },
{ id: 350, name: "Дор-блю", icon: "🧀" },

// Мясные деликатесы
{ id: 351, name: "Прошутто", icon: "🍖" },
{ id: 352, name: "Хамон", icon: "🍖" },
{ id: 353, name: "Салями", icon: "🍖" },
{ id: 354, name: "Пармская ветчина", icon: "🍖" },
{ id: 355, name: "Брезаола", icon: "🍖" },
{ id: 356, name: "Копченая грудинка", icon: "🥓" },
{ id: 357, name: "Карпаччо", icon: "🥩" },
{ id: 358, name: "Тартар", icon: "🥩" },
{ id: 359, name: "Ростбиф", icon: "🥩" },
{ id: 360, name: "Антрекот", icon: "🥩" },

// Рыбные деликатесы
{ id: 361, name: "Семга слабосоленая", icon: "🐟" },
{ id: 362, name: "Форель слабосоленая", icon: "🐟" },
{ id: 363, name: "Осетрина", icon: "🐟" },
{ id: 364, name: "Белуга", icon: "🐟" },
{ id: 365, name: "Севрюга", icon: "🐟" },
{ id: 366, name: "Икра красная", icon: "🐟" },
{ id: 367, name: "Икра черная", icon: "🐟" },
{ id: 368, name: "Икра летучей рыбы", icon: "🐟" },
{ id: 369, name: "Рыба холодного копчения", icon: "🐟" },
{ id: 370, name: "Рыба горячего копчения", icon: "🐟" },

// Бакалея
{ id: 371, name: "Сода пищевая", icon: "⚗️" },
{ id: 372, name: "Лимонная кислота", icon: "🍋" },
{ id: 373, name: "Желатин", icon: "🍮" },
{ id: 374, name: "Агар-агар", icon: "🌿" },
{ id: 375, name: "Пектин", icon: "🍎" },
{ id: 376, name: "Крахмал", icon: "🌾" },
{ id: 377, name: "Сухари панировочные", icon: "🍞" },
{ id: 378, name: "Кунжут", icon: "⚫" },
{ id: 379, name: "Мак", icon: "⚫" },
{ id: 380, name: "Ванилин", icon: "🌱" },
{ id: 381, name: "Батон", icon: "🥖" },
{ id: 382, name: "Тосты", icon: "🥖" }
];

    // Локальное хранилище для блюд (кеш)
    let dishes = [];
    
    // Локальное хранилище для плана на неделю (кеш)
    let weekPlan = {
        monday: { breakfast: [], lunch: [], dinner: [] },
        tuesday: { breakfast: [], lunch: [], dinner: [] },
        wednesday: { breakfast: [], lunch: [], dinner: [] },
        thursday: { breakfast: [], lunch: [], dinner: [] },
        friday: { breakfast: [], lunch: [], dinner: [] },
        saturday: { breakfast: [], lunch: [], dinner: [] },
        sunday: { breakfast: [], lunch: [], dinner: [] }
    };
    
    // Локальное хранилище для холодильника (кеш)
    let fridgeItems = [];
    
    // Локальное хранилище для списка покупок (кеш)
    let shoppingList = [];

    // DOM элементы
    const navButtons = document.querySelectorAll('.nav-btn');
    const sections = document.querySelectorAll('.section');
    const addDishForm = document.getElementById('add-dish-form');
    const ingredientSearch = document.getElementById('ingredient-search');
    const searchResults = document.getElementById('search-results');
    const selectedIngredients = document.getElementById('selected-ingredients');
    const dishesContainer = document.getElementById('dishes-container');
    const daySelects = document.querySelectorAll('.day-select');
    const generateShoppingListBtn = document.getElementById('generate-shopping-list');
    const shoppingListContainer = document.getElementById('shopping-list');
    const fridgeSearch = document.getElementById('fridge-search');
    const fridgeSearchResults = document.getElementById('fridge-search-results');
    const fridgeItemsContainer = document.getElementById('fridge-items');
    const shoppingSearch = document.getElementById('shopping-search');
    const shoppingSearchResults = document.getElementById('shopping-search-results');
    const clearShoppingListBtn = document.getElementById('clear-shopping-list');
    const clearFridgeBtn = document.getElementById('clear-fridge'); // Новая кнопка очистки холодильника

    // Инициализация приложения
    document.addEventListener('DOMContentLoaded', function() {
	// Обработчик отмены редактирования
document.getElementById('cancel-edit').addEventListener('click', function() {
    resetDishForm();
    showDishesSection();
});
        // Навигация между секциями
        navButtons.forEach(button => {
            button.addEventListener('click', function() {
                const targetId = this.getAttribute('data-target');
                
                // Обновляем активные кнопки
                navButtons.forEach(btn => btn.classList.remove('active'));
                this.classList.add('active');
                
                // Показываем целевую секцию
                sections.forEach(section => section.classList.remove('active'));
                document.getElementById(targetId).classList.add('active');
            });
        });
        
        // Загрузка данных из Firebase
        loadAllData();
        
// Поиск ингредиентов при добавлении блюда
ingredientSearch.addEventListener('input', function() {
    const query = this.value.toLowerCase();
    if (query.length < 1) {
        searchResults.style.display = 'none';
        return;
    }
    
    const filteredIngredients = ingredientsDB.filter(ingredient => 
        ingredient.name.toLowerCase().includes(query)
    ).sort((a, b) => {
        // Сначала ингредиенты, которые начинаются с запроса
        const aStartsWith = a.name.toLowerCase().startsWith(query);
        const bStartsWith = b.name.toLowerCase().startsWith(query);
        
        if (aStartsWith && !bStartsWith) return -1;
        if (!aStartsWith && bStartsWith) return 1;
        
        // Если оба начинаются или не начинаются - сортируем по алфавиту
        return a.name.localeCompare(b.name);
    });
    
    displaySearchResults(filteredIngredients, searchResults, addIngredient);
});




// Поиск ингредиентов для холодильника
        fridgeSearch.addEventListener('input', function() {
            const query = this.value.toLowerCase();
            if (query.length < 1) {
                fridgeSearchResults.style.display = 'none';
                return;
            }
            
            const filteredIngredients = ingredientsDB.filter(ingredient => 
                ingredient.name.toLowerCase().includes(query)
            ).sort((a, b) => {
                const aStartsWith = a.name.toLowerCase().startsWith(query);
                const bStartsWith = b.name.toLowerCase().startsWith(query);
                
                if (aStartsWith && !bStartsWith) return -1;
                if (!aStartsWith && bStartsWith) return 1;
                
                return a.name.localeCompare(b.name);
            });
            
            displaySearchResults(filteredIngredients, fridgeSearchResults, addToFridge);
        });
        
// Добавление нового блюда
addDishForm.addEventListener('submit', function(e) {
    e.preventDefault();
    
    const dishName = document.getElementById('dish-name').value;
    const dishDescription = document.getElementById('dish-description').value;
    
    // Получаем выбранные ингредиенты
    const ingredients = [];
    selectedIngredients.querySelectorAll('.ingredient-tag').forEach(tag => {
        const id = parseInt(tag.getAttribute('data-id'));
        const name = tag.getAttribute('data-name');
        const icon = tag.getAttribute('data-icon');
        ingredients.push({ id, name, icon });
    });
    
    if (ingredients.length === 0) {
        alert('Добавьте хотя бы один ингредиент');
        return;
    }
    
    const submitButton = this.querySelector('button[type="submit"]');
    const isEditing = submitButton.dataset.editingId;
    
    if (isEditing) {
        // Редактируем существующее блюдо
        const dishId = parseInt(isEditing);
        const dishIndex = dishes.findIndex(d => d.id === dishId);
        
        if (dishIndex !== -1) {
            dishes[dishIndex] = {
                ...dishes[dishIndex],
                name: dishName,
                description: dishDescription,
                ingredients: ingredients
            };
            
            saveDishesToFirebase();
            loadDishes();
            
            // Сбрасываем форму
            resetDishForm();
            
            alert('Блюдо успешно обновлено!');
        }
    } else {
        // Создаем новое блюдо
        const newDish = {
            id: Date.now(),
            name: dishName,
            description: dishDescription,
            ingredients: ingredients
        };
        
        // Добавляем в массив и сохраняем в Firebase
        dishes.push(newDish);
        saveDishesToFirebase();
        
        // Сбрасываем форму
        resetDishForm();
        
        // Перезагружаем список блюд
        loadDishes();
        
        alert('Блюдо успешно добавлено!');
    }
});

function resetDishForm() {
    addDishForm.reset();
    selectedIngredients.innerHTML = '';
    
    // Сбрасываем кнопку отправки
    const submitButton = addDishForm.querySelector('button[type="submit"]');
    submitButton.innerHTML = '<i class="fas fa-save"></i> Сохранить блюдо';
    delete submitButton.dataset.editingId;
    
    // Скрываем кнопку отмены
    document.getElementById('cancel-edit').style.display = 'none';
}
        
        // Генерация списка покупок
        generateShoppingListBtn.addEventListener('click', generateShoppingList);
        document.getElementById('clear-all-data').addEventListener('click', clearAllData);
		
		shoppingSearch.addEventListener('input', function() {
        const query = this.value.toLowerCase();
        if (query.length < 1) {
            shoppingSearchResults.style.display = 'none';
            return;
        }
        
        const filteredIngredients = ingredientsDB.filter(ingredient => 
            ingredient.name.toLowerCase().includes(query)
        ).sort((a, b) => {
            const aStartsWith = a.name.toLowerCase().startsWith(query);
            const bStartsWith = b.name.toLowerCase().startsWith(query);
            
            if (aStartsWith && !bStartsWith) return -1;
            if (!aStartsWith && bStartsWith) return 1;
            
            return a.name.localeCompare(b.name);
        });
        
        displaySearchResults(filteredIngredients, shoppingSearchResults, addToShoppingList);
    });
    
    // Очистка списка покупок
    clearShoppingListBtn.addEventListener('click', clearShoppingList);
	clearFridgeBtn.addEventListener('click', clearFridge);
    });

    // Функции для работы с Firebase
    async function loadAllData() {
        try {
            await loadDishesFromFirebase();
            await loadWeekPlanFromFirebase();
            await loadFridgeItemsFromFirebase();
            await loadShoppingListFromFirebase();
            
            // Обновляем UI после загрузки всех данных
            loadDishes();
            loadWeekPlan();
            loadFridgeItems();
            loadShoppingList();
        } catch (error) {
            console.error('Ошибка загрузки данных:', error);
        }
    }

    async function loadDishesFromFirebase() {
        try {
            const doc = await db.collection('users').doc(USER_ID).get();
            if (doc.exists && doc.data().dishes) {
                dishes = doc.data().dishes;
            } else {
                dishes = [];
            }
        } catch (error) {
            console.error('Ошибка загрузки блюд:', error);
            dishes = [];
        }
    }

    async function loadWeekPlanFromFirebase() {
        try {
            const doc = await db.collection('users').doc(USER_ID).get();
            if (doc.exists && doc.data().weekPlan) {
                weekPlan = doc.data().weekPlan;
            } else {
                weekPlan = {
                    monday: { breakfast: [], lunch: [], dinner: [] },
                    tuesday: { breakfast: [], lunch: [], dinner: [] },
                    wednesday: { breakfast: [], lunch: [], dinner: [] },
                    thursday: { breakfast: [], lunch: [], dinner: [] },
                    friday: { breakfast: [], lunch: [], dinner: [] },
                    saturday: { breakfast: [], lunch: [], dinner: [] },
                    sunday: { breakfast: [], lunch: [], dinner: [] }
                };
            }
        } catch (error) {
            console.error('Ошибка загрузки плана:', error);
        }
    }

    async function loadFridgeItemsFromFirebase() {
        try {
            const doc = await db.collection('users').doc(USER_ID).get();
            if (doc.exists && doc.data().fridgeItems) {
                fridgeItems = doc.data().fridgeItems;
            } else {
                fridgeItems = [];
            }
        } catch (error) {
            console.error('Ошибка загрузки холодильника:', error);
            fridgeItems = [];
        }
    }

    async function loadShoppingListFromFirebase() {
        try {
            const doc = await db.collection('users').doc(USER_ID).get();
            if (doc.exists && doc.data().shoppingList) {
                shoppingList = doc.data().shoppingList;
            } else {
                shoppingList = [];
            }
        } catch (error) {
            console.error('Ошибка загрузки списка покупок:', error);
            shoppingList = [];
        }
    }

    async function saveDishesToFirebase() {
        try {
            await db.collection('users').doc(USER_ID).set({
                dishes: dishes
            }, { merge: true });
        } catch (error) {
            console.error('Ошибка сохранения блюд:', error);
        }
    }

    async function saveWeekPlanToFirebase() {
        try {
            await db.collection('users').doc(USER_ID).set({
                weekPlan: weekPlan
            }, { merge: true });
        } catch (error) {
            console.error('Ошибка сохранения плана:', error);
        }
    }

    async function saveFridgeItemsToFirebase() {
        try {
            await db.collection('users').doc(USER_ID).set({
                fridgeItems: fridgeItems
            }, { merge: true });
        } catch (error) {
            console.error('Ошибка сохранения холодильника:', error);
        }
    }

    async function saveShoppingListToFirebase() {
        try {
            await db.collection('users').doc(USER_ID).set({
                shoppingList: shoppingList
            }, { merge: true });
        } catch (error) {
            console.error('Ошибка сохранения списка покупок:', error);
        }
    }

    // Функции для работы с данными (обновленные для работы с Firebase)
    function saveDishes() {
        saveDishesToFirebase();
    }
    
    function saveWeekPlan() {
        saveWeekPlanToFirebase();
    }
    
    function saveFridgeItems() {
        saveFridgeItemsToFirebase();
    }
    
    function saveShoppingList() {
        saveShoppingListToFirebase();
    }
    
// Обновленная функция загрузки блюд
async function loadDishes() {
    dishesContainer.innerHTML = '';
    
    if (dishes.length === 0) {
        dishesContainer.innerHTML = `
            <div class="empty-state">
                <i class="fas fa-utensils"></i>
                <h3>Пока нет добавленных блюд</h3>
                <p>Добавьте свое первое блюдо!</p>
            </div>
        `;
        return;
    }
    
    // Сначала показываем все блюда без изображений
    dishes.forEach(dish => {
        const dishCard = createDishCard(dish);
        dishesContainer.appendChild(dishCard);
    });
    
    // Добавляем обработчики для кнопок выбора блюд
    document.querySelectorAll('.select-dish').forEach(button => {
        button.addEventListener('click', function() {
            const dishId = parseInt(this.getAttribute('data-id'));
            selectDishForWeek(dishId);
        });
    });
    
    // Добавляем обработчики для кнопок удаления
    document.querySelectorAll('.delete-dish').forEach(button => {
        button.addEventListener('click', function() {
            const dishId = parseInt(this.getAttribute('data-id'));
            deleteDish(dishId);
        });
    });
    
    // Добавляем обработчики для кнопок редактирования
    document.querySelectorAll('.edit-dish').forEach(button => {
        button.addEventListener('click', function() {
            const dishId = parseInt(this.getAttribute('data-id'));
            editDish(dishId);
        });
    });
    
    // Обновляем опции в селектах недельного плана
    updateWeekPlanSelects();
    
    // Затем асинхронно загружаем изображения
    dishes.forEach(async (dish, index) => {
        if (!dish.imageUrl) {
            // Проверяем кэш
            if (imageCache.has(dish.name.toLowerCase())) {
                dish.imageUrl = imageCache.get(dish.name.toLowerCase());
                await saveDishImage(dish.id, dish.imageUrl);
                updateDishCardImage(dish.id, dish.imageUrl);
            } else {
                // Запрашиваем новое изображение
                const imageUrl = await getDishImageFromGoogle(dish.name);
                if (imageUrl) {
                    dish.imageUrl = imageUrl;
                    imageCache.set(dish.name.toLowerCase(), imageUrl);
                    await saveDishImage(dish.id, imageUrl);
                    updateDishCardImage(dish.id, imageUrl);
                }
            }
        }
    });
}



        

    function loadWeekPlan() {
        const weekPlanContainer = document.getElementById('week-plan');
        weekPlanContainer.innerHTML = '';
        
        const days = [
            { key: 'monday', name: 'Понедельник', icon: '📅' },
            { key: 'tuesday', name: 'Вторник', icon: '📅' },
            { key: 'wednesday', name: 'Среда', icon: '📅' },
            { key: 'thursday', name: 'Четверг', icon: '📅' },
            { key: 'friday', name: 'Пятница', icon: '📅' },
            { key: 'saturday', name: 'Суббота', icon: '🎉' },
            { key: 'sunday', name: 'Воскресенье', icon: '🌞' }
        ];
        
        days.forEach(day => {
            const dayCard = document.createElement('div');
            dayCard.className = 'compact-day-card';
            
            dayCard.innerHTML = `
                <div class="day-header">
                    <div class="day-title">${day.icon} ${day.name}</div>
                </div>
                <div class="meal-times">
                    <div class="meal-time">
                        <div class="meal-label"><i class="fas fa-sun"></i> Завтрак</div>
                        <div class="meal-select-container">
                            <select class="meal-select" data-day="${day.key}" data-meal="breakfast">
                                <option value="">Выберите блюдо</option>
                            </select>
                            <button class="add-meal-btn" data-day="${day.key}" data-meal="breakfast">
                                <i class="fas fa-plus"></i>
                            </button>
                        </div>
                        <div class="selected-meals" id="${day.key}-breakfast">
                            <!-- Выбранные блюда будут здесь -->
                        </div>
                    </div>
                    <div class="meal-time">
                        <div class="meal-label"><i class="fas fa-cloud-sun"></i> Обед</div>
                        <div class="meal-select-container">
                            <select class="meal-select" data-day="${day.key}" data-meal="lunch">
                                <option value="">Выберите блюдо</option>
                            </select>
                            <button class="add-meal-btn" data-day="${day.key}" data-meal="lunch">
                                <i class="fas fa-plus"></i>
                            </button>
                        </div>
                        <div class="selected-meals" id="${day.key}-lunch">
                            <!-- Выбранные блюда будут здесь -->
                        </div>
                    </div>
                    <div class="meal-time">
                        <div class="meal-label"><i class="fas fa-moon"></i> Ужин</div>
                        <div class="meal-select-container">
                            <select class="meal-select" data-day="${day.key}" data-meal="dinner">
                                <option value="">Выберите блюдо</option>
                            </select>
                            <button class="add-meal-btn" data-day="${day.key}" data-meal="dinner">
                                <i class="fas fa-plus"></i>
                            </button>
                        </div>
                        <div class="selected-meals" id="${day.key}-dinner">
                            <!-- Выбранные блюда будут здесь -->
                        </div>
                    </div>
                </div>
            `;
            
            weekPlanContainer.appendChild(dayCard);
        });
        
        // Обновляем селекты и выбранные блюда
        updateWeekPlanSelects();
        updateSelectedMeals();
        
        // Добавляем обработчики для кнопок добавления блюд
        document.querySelectorAll('.add-meal-btn').forEach(button => {
            button.addEventListener('click', function() {
                const day = this.getAttribute('data-day');
                const meal = this.getAttribute('data-meal');
                const select = document.querySelector(`.meal-select[data-day="${day}"][data-meal="${meal}"]`);
                const dishId = parseInt(select.value);
                
                if (dishId) {
                    addDishToPlan(day, meal, dishId);
                }
            });
        });
    }
    
    function loadFridgeItems() {
        fridgeItemsContainer.innerHTML = '';
        
        if (fridgeItems.length === 0) {
            fridgeItemsContainer.innerHTML = `
                <div style="width: 100%; text-align: center; color: var(--gray); padding: 10px;">
                    Холодильник пуст
                </div>
            `;
            return;
        }
        
        fridgeItems.forEach(item => {
            const itemElement = document.createElement('div');
            itemElement.className = 'fridge-item';
            itemElement.innerHTML = `
                <span class="ingredient-icon">${item.icon}</span>
                ${item.name}
                <span class="remove" data-id="${item.id}">&times;</span>
            `;
            
            fridgeItemsContainer.appendChild(itemElement);
        });
        
        // Добавляем обработчики для удаления
        document.querySelectorAll('.fridge-item .remove').forEach(button => {
            button.addEventListener('click', function() {
                const ingredientId = parseInt(this.getAttribute('data-id'));
                removeFromFridge(ingredientId);
            });
        });
    }

    // Функция очистки холодильника
    function clearFridge() {
        if (fridgeItems.length === 0) {
            alert('Холодильник уже пуст!');
            return;
        }
        
        if (confirm('Вы уверены, что хотите очистить весь холодильник?')) {
            fridgeItems = [];
            saveFridgeItems();
            loadFridgeItems();
        }
    }
    
function loadShoppingList() {
    shoppingListContainer.innerHTML = '';
    
    if (shoppingList.length === 0) {
        shoppingListContainer.innerHTML = `
            <div class="empty-state">
                <i class="fas fa-shopping-cart"></i>
                <h3>Список покупок пуст</h3>
                <p>Сгенерируйте список покупок из плана питания</p>
            </div>
        `;
        return;
    }
    
    shoppingList.forEach(item => {
        const listItem = document.createElement('div');
        listItem.className = 'shopping-item';
        listItem.innerHTML = `
            <div class="item-info" style="display: flex; align-items: center; gap: 10px; flex: 1; cursor: pointer;">
                <div class="checkbox-wrapper" style="position: relative; width: 22px; height: 22px;">
                    <input type="checkbox" class="checkbox" ${item.checked ? 'checked' : ''} style="position: absolute; opacity: 0; width: 100%; height: 100%; cursor: pointer; z-index: 2;">
                    <div class="custom-checkbox" style="width: 22px; height: 22px; border: 2px solid ${item.checked ? 'var(--primary)' : 'var(--gray)'}; border-radius: 50%; background: ${item.checked ? 'var(--primary)' : 'transparent'}; display: flex; align-items: center; justify-content: center; position: relative; z-index: 1;">
                        ${item.checked ? '<i class="fas fa-check" style="color: white; font-size: 12px;"></i>' : ''}
                    </div>
                </div>
                <span class="ingredient-icon">${item.icon}</span>
                <span class="item-name" style="${item.checked ? 'text-decoration: line-through; color: var(--gray);' : ''}">${item.name}</span>
            </div>
            <div class="item-actions">
                <button class="btn btn-danger remove-item" data-id="${item.id}" style="padding: 8px; font-size: 0.8rem;">
                    <i class="fas fa-trash"></i>
                </button>
            </div>
        `;
        
        shoppingListContainer.appendChild(listItem);
    });
    
    // Добавляем обработчики для чекбоксов и кликов по всей области
    document.querySelectorAll('.shopping-item .checkbox').forEach(checkbox => {
        checkbox.addEventListener('change', function() {
            const itemElement = this.closest('.shopping-item');
            const itemName = itemElement.querySelector('.item-name').textContent;
            toggleShoppingItem(itemName);
        });
    });
    
    // Добавляем обработчики для клика по всей области элемента
    document.querySelectorAll('.shopping-item .item-info').forEach(itemInfo => {
        itemInfo.addEventListener('click', function(e) {
            // Проверяем, что клик не по кнопке удаления
            if (!e.target.closest('.remove-item')) {
                const checkbox = this.querySelector('.checkbox');
                checkbox.checked = !checkbox.checked;
                checkbox.dispatchEvent(new Event('change'));
            }
        });
    });
    
    document.querySelectorAll('.remove-item').forEach(button => {
        button.addEventListener('click', function(e) {
            e.stopPropagation(); // Предотвращаем срабатывание клика по родительскому элементу
            const itemId = parseInt(this.getAttribute('data-id'));
            removeFromShoppingList(itemId);
        });
    });
}
    
    function displaySearchResults(results, container, clickHandler) {
        container.innerHTML = '';
        
        if (results.length === 0) {
            container.style.display = 'none';
            return;
        }
        
        results.forEach(ingredient => {
            const resultItem = document.createElement('div');
            resultItem.className = 'search-result-item';
            resultItem.innerHTML = `
                <span class="ingredient-icon">${ingredient.icon}</span>
                ${ingredient.name}
            `;
            
            resultItem.addEventListener('click', function() {
                clickHandler(ingredient);
                container.style.display = 'none';
            });
            
            container.appendChild(resultItem);
        });
        
        container.style.display = 'block';
    }
    
    function addIngredient(ingredient) {
        // Проверяем, не добавлен ли уже ингредиент
        const isAlreadyAdded = Array.from(selectedIngredients.querySelectorAll('.ingredient-tag'))
            .some(tag => parseInt(tag.getAttribute('data-id')) === ingredient.id);
        
        if (isAlreadyAdded) {
            return;
        }
        
        const ingredientTag = document.createElement('div');
        ingredientTag.className = 'ingredient-tag';
        ingredientTag.setAttribute('data-id', ingredient.id);
        ingredientTag.setAttribute('data-name', ingredient.name);
        ingredientTag.setAttribute('data-icon', ingredient.icon);
        ingredientTag.innerHTML = `
            <span class="ingredient-icon">${ingredient.icon}</span>
            ${ingredient.name}
            <span class="remove">&times;</span>
        `;
        
        // Добавляем обработчик для удаления
        ingredientTag.querySelector('.remove').addEventListener('click', function() {
            ingredientTag.remove();
        });
        
        selectedIngredients.appendChild(ingredientTag);
        ingredientSearch.value = '';
        searchResults.style.display = 'none';
    }
    
    function addToFridge(ingredient) {
        // Проверяем, не добавлен ли уже ингредиент
        const isAlreadyAdded = fridgeItems.some(item => item.id === ingredient.id);
        
        if (isAlreadyAdded) {
            return;
        }
        
        fridgeItems.push(ingredient);
        saveFridgeItems();
        loadFridgeItems();
        
        fridgeSearch.value = '';
        fridgeSearchResults.style.display = 'none';
    }
    
    function removeFromFridge(ingredientId) {
        fridgeItems = fridgeItems.filter(item => item.id !== ingredientId);
        saveFridgeItems();
        loadFridgeItems();
    }
    
    function selectDishForWeek(dishId) {
        // Переходим к разделу плана питания
        navButtons.forEach(btn => btn.classList.remove('active'));
        document.querySelector('[data-target="week-plan-section"]').classList.add('active');
        sections.forEach(section => section.classList.remove('active'));
        document.getElementById('week-plan-section').classList.add('active');
    }
    
    function deleteDish(dishId) {
        if (confirm('Вы уверены, что хотите удалить это блюдо?')) {
            dishes = dishes.filter(dish => dish.id !== dishId);
            saveDishes();
            loadDishes();
        }
    }
    
    function updateWeekPlanSelects() {
        document.querySelectorAll('.meal-select').forEach(select => {
            // Сохраняем текущее значение
            const currentValue = select.value;
            
            // Очищаем опции (кроме первой)
            while (select.children.length > 1) {
                select.removeChild(select.lastChild);
            }
            
            // Добавляем блюда
            dishes.forEach(dish => {
                const option = document.createElement('option');
                option.value = dish.id;
                option.textContent = dish.name;
                select.appendChild(option);
            });
            
            // Восстанавливаем значение, если оно есть
            if (currentValue) {
                select.value = currentValue;
            }
        });
    }
    
    function updateSelectedMeals() {
        Object.keys(weekPlan).forEach(day => {
            ['breakfast', 'lunch', 'dinner'].forEach(meal => {
                const container = document.getElementById(`${day}-${meal}`);
                container.innerHTML = '';
                
                weekPlan[day][meal].forEach(dishId => {
                    const dish = dishes.find(d => d.id === dishId);
                    if (dish) {
                        const mealElement = document.createElement('div');
                        mealElement.className = 'selected-meal';
                        mealElement.innerHTML = `
                            ${dish.name}
                            <div class="meal-actions">
                                <button class="remove-meal" data-day="${day}" data-meal="${meal}" data-dish="${dishId}">
                                    <i class="fas fa-times"></i>
                                </button>
                            </div>
                        `;
                        
                        container.appendChild(mealElement);
                    }
                });
            });
        });
        
        // Добавляем обработчики для удаления блюд из плана
        document.querySelectorAll('.remove-meal').forEach(button => {
            button.addEventListener('click', function() {
                const day = this.getAttribute('data-day');
                const meal = this.getAttribute('data-meal');
                const dishId = parseInt(this.getAttribute('data-dish'));
                
                removeDishFromPlan(day, meal, dishId);
            });
        });
    }
    
    function addDishToPlan(day, meal, dishId) {
        // Проверяем, не добавлено ли уже это блюдо
        if (!weekPlan[day][meal].includes(dishId)) {
            weekPlan[day][meal].push(dishId);
            saveWeekPlan();
            updateSelectedMeals();
        }
    }
    
    function removeDishFromPlan(day, meal, dishId) {
        weekPlan[day][meal] = weekPlan[day][meal].filter(id => id !== dishId);
        saveWeekPlan();
        updateSelectedMeals();
    }

// Функция добавления продукта в список покупок
function addToShoppingList(ingredient) {
    // Проверяем, не добавлен ли уже ингредиент
    const isAlreadyAdded = shoppingList.some(item => 
        item.id === ingredient.id || 
        item.name.replace(/\s*\(x\d+\)$/, '') === ingredient.name
    );
    
    if (isAlreadyAdded) {
        alert('Этот продукт уже есть в списке покупок!');
        return;
    }
    
    // Добавляем продукт
    shoppingList.push({
        id: ingredient.id,
        name: ingredient.name,
        icon: ingredient.icon,
        checked: false,
        manuallyAdded: true // Помечаем как добавленный вручную
    });
    
    saveShoppingList();
    loadShoppingList();
    
    shoppingSearch.value = '';
    shoppingSearchResults.style.display = 'none';
    
    // Показываем уведомление
    //showNotification(`"${ingredient.name}" добавлен в список покупок!`);
}

// Функция очистки списка покупок
function clearShoppingList() {
    if (shoppingList.length === 0) {
        alert('Список покупок уже пуст!');
        return;
    }
    
    if (confirm('Вы уверены, что хотите очистить весь список покупок?')) {
        shoppingList = [];
        saveShoppingList();
        loadShoppingList();
        //showNotification('Список покупок очищен!');
    }
}

// Функция для показа уведомлений (добавьте эту вспомогательную функцию)
function showNotification(message) {
    // Создаем элемент уведомления
    const notification = document.createElement('div');
    notification.style.cssText = `
        position: fixed;
        top: 100px;
        right: 20px;
        background: var(--primary);
        color: white;
        padding: 12px 20px;
        border-radius: 8px;
        box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        z-index: 1000;
        font-weight: 600;
        transform: translateX(400px);
        transition: transform 0.3s ease;
        max-width: 300px;
    `;
    notification.textContent = message;
    
    document.body.appendChild(notification);
    
    // Анимация появления
    setTimeout(() => {
        notification.style.transform = 'translateX(0)';
    }, 10);
    
    // Автоматическое скрытие через 3 секунды
    setTimeout(() => {
        notification.style.transform = 'translateX(400px)';
        setTimeout(() => {
            if (notification.parentNode) {
                notification.parentNode.removeChild(notification);
            }
        }, 300);
    }, 3000);
}

    
    function generateShoppingList() {
        // Собираем все ингредиенты из плана на неделю
        const allIngredients = [];
        
        Object.keys(weekPlan).forEach(day => {
            ['breakfast', 'lunch', 'dinner'].forEach(meal => {
                weekPlan[day][meal].forEach(dishId => {
                    const dish = dishes.find(d => d.id === dishId);
                    if (dish) {
                        dish.ingredients.forEach(ingredient => {
                            allIngredients.push(ingredient);
                        });
                    }
                });
            });
        });
        
        // Группируем ингредиенты по id и исключаем те, что есть в холодильнике
        const ingredientCounts = {};
        allIngredients.forEach(ingredient => {
            if (!fridgeItems.some(item => item.id === ingredient.id)) {
                if (!ingredientCounts[ingredient.id]) {
                    ingredientCounts[ingredient.id] = {
                        ...ingredient,
                        count: 1
                    };
                } else {
                    ingredientCounts[ingredient.id].count++;
                }
            }
        });
        
        // Формируем список покупок
        shoppingList = Object.values(ingredientCounts).map(item => ({
            id: item.id,
            name: item.count > 1 ? `${item.name} (x${item.count})` : item.name,
            icon: item.icon,
            checked: false
        }));
        
        saveShoppingList();
        loadShoppingList();
        
        // Переходим к списку покупок
        navButtons.forEach(btn => btn.classList.remove('active'));
        document.querySelector('[data-target="shopping-list-section"]').classList.add('active');
        sections.forEach(section => section.classList.remove('active'));
        document.getElementById('shopping-list-section').classList.add('active');
        
        alert('Список покупок сгенерирован!');
    }
    
function toggleShoppingItem(itemName) {
    // Находим элемент по имени (без количества, если есть)
    const baseName = itemName.replace(/\s*\(x\d+\)$/, '');
    
    let itemToggled = false;
    
    shoppingList.forEach(item => {
        const itemBaseName = item.name.replace(/\s*\(x\d+\)$/, '');
        if (itemBaseName === baseName) {
            item.checked = !item.checked;
            itemToggled = true;
        }
    });
    
    if (itemToggled) {
        saveShoppingList();
        loadShoppingList();
        //showNotification(`"${baseName}" ${shoppingList.find(item => item.name.replace(/\s*\(x\d+\)$/, '') === baseName).checked ? 'отмечен' : 'не отмечен'}`);
    }
}
    
function removeFromShoppingList(itemId) {
    shoppingList = shoppingList.filter(item => item.id !== itemId);
    saveShoppingList();
    loadShoppingList();
    //showNotification('Продукт удален из списка покупок');
}
    
    async function clearAllData() {
        if (confirm('Вы уверены, что хотите удалить все данные? Это действие нельзя отменить.')) {
            try {
                // Очищаем Firebase
                await db.collection('users').doc(USER_ID).delete();
                
                // Очищаем локальные данные
                dishes = [];
                weekPlan = {
                    monday: { breakfast: [], lunch: [], dinner: [] },
                    tuesday: { breakfast: [], lunch: [], dinner: [] },
                    wednesday: { breakfast: [], lunch: [], dinner: [] },
                    thursday: { breakfast: [], lunch: [], dinner: [] },
                    friday: { breakfast: [], lunch: [], dinner: [] },
                    saturday: { breakfast: [], lunch: [], dinner: [] },
                    sunday: { breakfast: [], lunch: [], dinner: [] }
                };
                fridgeItems = [];
                shoppingList = [];
                
                loadDishes();
                loadWeekPlan();
                loadFridgeItems();
                loadShoppingList();
                
                alert('Все данные удалены!');
            } catch (error) {
                console.error('Ошибка удаления данных:', error);
                alert('Произошла ошибка при удалении данных');
            }
        }
    }

// Добавляем обработчики для кнопок редактирования
document.querySelectorAll('.edit-dish').forEach(button => {
    button.addEventListener('click', function() {
        const dishId = parseInt(this.getAttribute('data-id'));
        editDish(dishId);
    });
});

function editDish(dishId) {
    const dish = dishes.find(d => d.id === dishId);
    if (!dish) return;

    // Заполняем форму данными блюда
    document.getElementById('dish-name').value = dish.name;
    document.getElementById('dish-description').value = dish.description || '';
    
    // Очищаем и заполняем список ингредиентов
    selectedIngredients.innerHTML = '';
    dish.ingredients.forEach(ingredient => {
        const ingredientTag = document.createElement('div');
        ingredientTag.className = 'ingredient-tag';
        ingredientTag.setAttribute('data-id', ingredient.id);
        ingredientTag.setAttribute('data-name', ingredient.name);
        ingredientTag.setAttribute('data-icon', ingredient.icon);
        ingredientTag.innerHTML = `
            <span class="ingredient-icon">${ingredient.icon}</span>
            ${ingredient.name}
            <span class="remove">&times;</span>
        `;
        
        ingredientTag.querySelector('.remove').addEventListener('click', function() {
            ingredientTag.remove();
        });
        
        selectedIngredients.appendChild(ingredientTag);
    });

    // Изменяем поведение формы для редактирования
    const submitButton = addDishForm.querySelector('button[type="submit"]');
    submitButton.innerHTML = '<i class="fas fa-save"></i> Сохранить изменения';
    submitButton.dataset.editingId = dishId;

    // Показываем кнопку отмены
    document.getElementById('cancel-edit').style.display = 'block';

    // Показываем секцию добавления блюда
    navButtons.forEach(btn => btn.classList.remove('active'));
    document.querySelector('[data-target="add-dish-section"]').addEventListener('click', function() {
    resetDishForm();
});
    sections.forEach(section => section.classList.remove('active'));
    document.getElementById('add-dish-section').classList.add('active');
    
    // Прокручиваем к верху страницы
    window.scrollTo(0, 0);
}

// Функция для сохранения изображения в Firebase
async function saveDishImage(dishId, imageUrl) {
    const dish = dishes.find(d => d.id === dishId);
    if (dish) {
        dish.imageUrl = imageUrl;
        await saveDishesToFirebase();
    }
}

// Функция обновления изображения в карточке
function updateDishCardImage(dishId, imageUrl) {
    const dishCard = document.querySelector(`.dish-card .select-dish[data-id="${dishId}"]`)?.closest('.dish-card');
    if (dishCard) {
        const dishImage = dishCard.querySelector('.dish-image');
        dishImage.innerHTML = `<img src="${imageUrl}" alt="${dishes.find(d => d.id === dishId)?.name}" onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';" loading="lazy">`;
    }
}

function createDishCard(dish) {
    const dishCard = document.createElement('div');
    dishCard.className = 'dish-card';
    
    const ingredientsText = dish.ingredients.map(ing => ing.name).join(', ');
    
    // Определяем содержимое для изображения
    let imageContent = '';
    if (dish.imageUrl) {
        imageContent = `
            <img src="${dish.imageUrl}" alt="${dish.name}" 
                 onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';"
                 loading="lazy">
            <i class="fas fa-utensils" style="display: none;"></i>
        `;
    } else {
        imageContent = `
            <img src="" alt="" style="display: none;">
            <i class="fas fa-utensils"></i>
        `;
    }
    
    dishCard.innerHTML = `
        <div class="dish-image">
            ${imageContent}
        </div>
        <div class="dish-content">
            <div class="dish-title">${dish.name}</div>
            <div class="dish-ingredients">${ingredientsText}</div>
            <div class="dish-actions">
                <button class="btn btn-secondary select-dish" data-id="${dish.id}">
                    <i class="fas fa-calendar-plus"></i> Выбрать
                </button>
                <button class="btn edit-dish" data-id="${dish.id}" style="background: #4CAF50; color: white; width: fit-content;">
                    <i class="fas fa-edit"></i>
                </button>
                <button class="btn btn-danger delete-dish" data-id="${dish.id}">
                    <i class="fas fa-trash"></i> Удалить
                </button>
            </div>
        </div>
    `;
    
    // Добавляем обработчики событий
    addDishCardEventListeners(dishCard, dish.id);
    
    return dishCard;
}
// Функция для добавления обработчиков событий (вынесена для переиспользования)
function addDishCardEventListeners(dishCard, dishId) {
    // Обработчик для кнопки выбора
    dishCard.querySelector('.select-dish').addEventListener('click', function() {
        selectDishForWeek(dishId);
    });
    
    // Обработчик для кнопки редактирования
    dishCard.querySelector('.edit-dish').addEventListener('click', function() {
        editDish(dishId);
    });
    
    // Обработчик для кнопки удаления
    dishCard.querySelector('.delete-dish').addEventListener('click', function() {
        deleteDish(dishId);
    });
}

// Функция для принудительного обновления изображений блюда
async function refreshDishImage(dishId) {
    const dish = dishes.find(d => d.id === dishId);
    if (dish) {
        const imageUrl = await getDishImageFromGoogle(dish.name);
        if (imageUrl) {
            dish.imageUrl = imageUrl;
            imageCache.set(dish.name.toLowerCase(), imageUrl);
            await saveDishImage(dishId, imageUrl);
            updateDishCardImage(dishId, imageUrl);
            return true;
        }
    }
    return false;
}

document.getElementById('back-to-dishes').addEventListener('click', function() {
    showDishesSection();
});

function showDishesSection() {
    navButtons.forEach(btn => btn.classList.remove('active'));
    document.querySelector('[data-target="dishes-section"]').classList.add('active');
    sections.forEach(section => section.classList.remove('active'));
    document.getElementById('dishes-section').classList.add('active');
}
</script>
</body>
</html>